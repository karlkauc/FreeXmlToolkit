<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.*?>
<VBox prefHeight="768.0" prefWidth="1024.0" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0"
      AnchorPane.rightAnchor="0" AnchorPane.topAnchor="0" xmlns="http://javafx.com/javafx/11.0.14-internal"
      xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.fxt.freexmltoolkit.controller.SchematronController">

    <!-- Main Tab Container -->
    <TabPane fx:id="tabPane" VBox.vgrow="ALWAYS">

        <!-- Welcome/Overview Tab -->
        <Tab fx:id="overviewTab" text="Overview" closable="false">
            <graphic>
                <FontIcon iconLiteral="bi-info-circle" iconColor="#007bff" iconSize="16"/>
            </graphic>
            <ScrollPane fitToWidth="true" fitToHeight="true">
                <VBox spacing="15" style="-fx-padding: 20;">

                    <!-- Header -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontIcon iconLiteral="bi-shield-check" iconColor="#ff6b6b" iconSize="32"/>
                        <VBox spacing="5">
                            <Label text="Schematron Validator" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                            <Label text="Business Rules and Validation for XML Documents"
                                   style="-fx-text-fill: #6c757d;"/>
                        </VBox>
                    </HBox>

                    <Separator/>

                    <!-- What is Schematron -->
                    <VBox spacing="10">
                        <Label text="What is Schematron?" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                        <Label text="Schematron is a rule-based validation system for XML documents. It enables the definition of business rules and integrity constraints that go beyond the capabilities of XML Schema (XSD)."
                               wrapText="true" style="-fx-text-fill: #495057;"/>
                    </VBox>

                    <!-- Features Grid -->
                    <GridPane hgap="20" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="50.0"/>
                            <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="50.0"/>
                        </columnConstraints>

                        <!-- Feature 1 -->
                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <FontIcon iconLiteral="bi-code-slash" iconColor="#28a745" iconSize="20"/>
                                <Label text="Code Editor" style="-fx-font-weight: bold;"/>
                            </HBox>
                            <Label text="Create and edit Schematron rules with syntax highlighting and auto-completion"
                                   wrapText="true" style="-fx-text-fill: #6c757d; -fx-font-size: 12px;"/>
                        </VBox>

                        <!-- Feature 2 -->
                        <VBox spacing="8" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <FontIcon iconLiteral="bi-diagram-3" iconColor="dodgerblue" iconSize="20"/>
                                <Label text="Visual Builder" style="-fx-font-weight: bold;"/>
                            </HBox>
                            <Label text="Create rules visually without XML knowledge using a user-friendly interface"
                                   wrapText="true" style="-fx-text-fill: #6c757d; -fx-font-size: 12px;"/>
                        </VBox>

                        <!-- Feature 3 -->
                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <FontIcon iconLiteral="bi-play-circle" iconColor="#ff6b6b" iconSize="20"/>
                                <Label text="Testing" style="-fx-font-weight: bold;"/>
                            </HBox>
                            <Label text="Validate XML documents against your Schematron rules and see detailed results"
                                   wrapText="true" style="-fx-text-fill: #6c757d; -fx-font-size: 12px;"/>
                        </VBox>

                        <!-- Feature 4 -->
                        <VBox spacing="8" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <FontIcon iconLiteral="bi-book" iconColor="#16a34a" iconSize="20"/>
                                <Label text="Documentation" style="-fx-font-weight: bold;"/>
                            </HBox>
                            <Label text="Automatically generate documentation for your Schematron rules and validation logic"
                                   wrapText="true" style="-fx-text-fill: #6c757d; -fx-font-size: 12px;"/>
                        </VBox>
                    </GridPane>

                    <Separator/>

                    <!-- Getting Started -->
                    <VBox spacing="10">
                        <Label text="Getting Started:" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                        <VBox spacing="8">
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <Label text="1." style="-fx-font-weight: bold; -fx-text-fill: #007bff;"/>
                                <Label text="Go to the 'Code' tab to create a new Schematron schema or load an existing one"
                                       wrapText="true"/>
                            </HBox>
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <Label text="2." style="-fx-font-weight: bold; -fx-text-fill: #007bff;"/>
                                <Label text="Use the 'New Rule' and 'New Pattern' buttons to add validation rules"
                                       wrapText="true"/>
                            </HBox>
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <Label text="3." style="-fx-font-weight: bold; -fx-text-fill: #007bff;"/>
                                <Label text="Test your rules in the 'Test' tab with sample XML documents"
                                       wrapText="true"/>
                            </HBox>
                            <HBox alignment="CENTER_LEFT" spacing="8">
                                <Label text="4." style="-fx-font-weight: bold; -fx-text-fill: #007bff;"/>
                                <Label text="Generate documentation for your schema in the 'Documentation' tab"
                                       wrapText="true"/>
                            </HBox>
                        </VBox>
                    </VBox>

                    <!-- Quick Actions -->
                    <VBox spacing="10">
                        <Label text="Quick Actions:" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                        <HBox spacing="10">
                            <Button text="Create New Schema">
                                <graphic>
                                    <FontIcon iconLiteral="bi-plus-circle" iconColor="#28a745" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button text="Load Schema">
                                <graphic>
                                    <FontIcon iconLiteral="bi-folder2-open" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button text="Show Examples">
                                <graphic>
                                    <FontIcon iconLiteral="bi-lightbulb" iconColor="#ffc107" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>
                    </VBox>

                </VBox>
            </ScrollPane>
        </Tab>

        <!-- Code Editor Tab -->
        <Tab fx:id="codeTab" text="Code" closable="false">
            <graphic>
                <FontIcon iconLiteral="bi-code-slash" iconSize="16"/>
            </graphic>
            <VBox spacing="0">
                <!-- Toolbar -->
                <ToolBar fx:id="toolbar">
                    <Button fx:id="newRuleButton" text="New Rule">
                        <graphic>
                            <FontIcon iconLiteral="bi-plus-circle" iconColor="#28a745" iconSize="14"/>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Insert a new rule template"/>
                        </tooltip>
                    </Button>

                    <Button fx:id="newPatternButton" text="New Pattern">
                        <graphic>
                            <FontIcon iconLiteral="bi-collection" iconColor="#007bff" iconSize="14"/>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Insert a new pattern template"/>
                        </tooltip>
                    </Button>

                    <Separator orientation="VERTICAL"/>

                    <Button fx:id="validateButton" text="Validate">
                        <graphic>
                            <FontIcon iconLiteral="bi-check-circle" iconColor="#17a2b8" iconSize="14"/>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Validate Schematron syntax"/>
                        </tooltip>
                    </Button>

                    <Button fx:id="testRulesButton" text="Test Rules">
                        <graphic>
                            <FontIcon iconLiteral="bi-play-circle" iconColor="#ff6b6b" iconSize="14"/>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Test rules against XML files"/>
                        </tooltip>
                    </Button>

                    <Separator orientation="VERTICAL"/>

                    <!-- Favorites Buttons -->
                    <Button fx:id="addSchematronToFavoritesButton" text="★ Add"
                            onAction="#addCurrentSchematronToFavorites">
                        <graphic>
                            <FontIcon iconLiteral="bi-star" iconColor="#ffc107" iconSize="14"/>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Add current Schematron file to favorites"/>
                        </tooltip>
                    </Button>

                    <MenuButton fx:id="loadSchematronFavoritesButton" text="Favorites">
                        <graphic>
                            <FontIcon iconLiteral="bi-star-fill" iconColor="#ffc107" iconSize="14"/>
                        </graphic>
                        <tooltip>
                            <Tooltip text="Load from favorites"/>
                        </tooltip>
                    </MenuButton>
                </ToolBar>

                <!-- Main Content Area with Split Pane -->
                <SplitPane dividerPositions="0.75" VBox.vgrow="ALWAYS">

                    <!-- Main Editor Area -->
                    <VBox fx:id="codeEditorContainer" spacing="0" SplitPane.resizableWithParent="true">
                        <org.fxt.freexmltoolkit.controls.SchematronCodeEditor fx:id="schematronCodeEditor"
                                                                              VBox.vgrow="ALWAYS"/>
                    </VBox>

                    <!-- Sidebar -->
                    <VBox fx:id="sidebarContainer" spacing="5" minWidth="200" maxWidth="400" prefWidth="300">
                        <padding>
                            <Insets top="5" right="5" bottom="5" left="5"/>
                        </padding>

                        <!-- Quick Help -->
                        <TitledPane fx:id="helpPane" text="Quick Help" expanded="true" collapsible="true">
                            <VBox spacing="8" style="-fx-padding: 5;">
                                <Label text="Schematron Basics:"
                                       style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                <VBox spacing="5">
                                    <Label text="• &lt;pattern&gt; - Groups related rules together"
                                           style="-fx-font-size: 11px;" wrapText="true"/>
                                    <Label text="• &lt;rule&gt; - Defines context and conditions"
                                           style="-fx-font-size: 11px;" wrapText="true"/>
                                    <Label text="• &lt;assert&gt; - Tests a condition (must be true)"
                                           style="-fx-font-size: 11px;" wrapText="true"/>
                                    <Label text="• &lt;report&gt; - Reports a finding (when condition is true)"
                                           style="-fx-font-size: 11px;" wrapText="true"/>
                                </VBox>

                                <Separator/>

                                <Label text="Common XPath Expressions:"
                                       style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                <VBox spacing="5">
                                    <Label text="• . - Current node" style="-fx-font-size: 11px;"/>
                                    <Label text="• @attribute - Attribute of current node"
                                           style="-fx-font-size: 11px;"/>
                                    <Label text="• child::element - Child element" style="-fx-font-size: 11px;"/>
                                    <Label text="• count(element) - Count elements" style="-fx-font-size: 11px;"/>
                                    <Label text="• string-length(.) &gt; 0 - Text present"
                                           style="-fx-font-size: 11px;"/>
                                </VBox>
                            </VBox>
                        </TitledPane>

                        <!-- Schematron Structure -->
                        <TitledPane fx:id="structurePane" text="Document Structure" expanded="true" collapsible="true">
                            <VBox spacing="5">
                                <Label text="Structure of current schema:" style="-fx-font-size: 11px;"/>
                                <ListView prefHeight="100">
                                    <placeholder>
                                        <VBox alignment="CENTER" spacing="5">
                                            <FontIcon iconLiteral="bi-file-earmark-code" iconColor="#ced4da"
                                                      iconSize="24"/>
                                            <Label text="No schema loaded yet"
                                                   style="-fx-text-fill: #6c757d; -fx-font-size: 11px;"/>
                                        </VBox>
                                    </placeholder>
                                </ListView>
                            </VBox>
                        </TitledPane>

                        <!-- Rule Templates -->
                        <TitledPane fx:id="templatesPane" text="Rule Templates" expanded="false" collapsible="true">
                            <org.fxt.freexmltoolkit.controls.SchematronTemplateLibrary fx:id="templateLibrary"/>
                        </TitledPane>

                        <!-- XPath Helper -->
                        <TitledPane fx:id="xpathHelperPane" text="XPath Tester" expanded="false" collapsible="true"
                                    VBox.vgrow="ALWAYS">
                            <VBox spacing="8" style="-fx-padding: 5;">
                                <Label text="Test XPath Expression:"
                                       style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <TextField promptText="Enter an XPath expression..."
                                           style="-fx-font-size: 11px;"/>
                                <Button text="Test" style="-fx-font-size: 10px;">
                                    <graphic>
                                        <FontIcon iconLiteral="bi-play" iconSize="10"/>
                                    </graphic>
                                </Button>

                                <Label text="Result:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <TextArea prefRowCount="3" editable="false" style="-fx-font-size: 10px;"
                                          promptText="XPath result will be displayed here..."/>

                                <Separator/>

                                <Label text="XPath Functions:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <ListView prefHeight="80" style="-fx-font-size: 10px;">
                                    <placeholder>
                                        <VBox alignment="CENTER" spacing="5">
                                            <Label text="count() - Count elements" style="-fx-font-size: 10px;"/>
                                            <Label text="string-length() - Text length" style="-fx-font-size: 10px;"/>
                                            <Label text="contains() - Text contains" style="-fx-font-size: 10px;"/>
                                            <Label text="starts-with() - Text starts with"
                                                   style="-fx-font-size: 10px;"/>
                                            <Label text="normalize-space() - Normalize whitespace"
                                                   style="-fx-font-size: 10px;"/>
                                        </VBox>
                                    </placeholder>
                                </ListView>
                            </VBox>
                        </TitledPane>

                    </VBox>

                </SplitPane>
            </VBox>
        </Tab>

        <!-- Visual Builder Tab -->
        <Tab fx:id="visualBuilderTab" text="Visual Builder" closable="false">
            <graphic>
                <FontIcon iconLiteral="bi-diagram-3" iconColor="dodgerblue" iconSize="16"/>
            </graphic>
            <org.fxt.freexmltoolkit.controls.SchematronVisualBuilder fx:id="visualBuilder"/>
        </Tab>

        <!-- Test Tab -->
        <Tab fx:id="testTab" text="Test" closable="false">
            <graphic>
                <FontIcon iconLiteral="bi-play-circle" iconColor="#ff6b6b" iconSize="16"/>
            </graphic>
            <VBox spacing="15" style="-fx-padding: 20;">

                    <!-- Header -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <FontIcon iconLiteral="bi-play-circle" iconColor="#ff6b6b" iconSize="32"/>
                        <VBox spacing="5">
                            <Label text="Schematron Testing" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                            <Label text="Test your Schematron rules with XML documents"
                                   style="-fx-text-fill: #6c757d;"/>
                        </VBox>
                    </HBox>

                    <Separator/>

                <!-- Control Buttons -->
                <HBox spacing="10" style="-fx-padding: 10;">
                    <Button fx:id="loadSchemaFromFileButton" text="Load Schema from File"
                            onAction="#loadSchemaFromFile">
                        <graphic>
                            <FontIcon iconLiteral="bi-folder2-open" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Button fx:id="useCurrentSchemaButton" text="Use Current Schema" onAction="#useCurrentSchema">
                        <graphic>
                            <FontIcon iconLiteral="bi-code-slash" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Separator orientation="VERTICAL"/>
                    <Button fx:id="addXmlFileButton" text="Add XML File" onAction="#addXmlFile">
                        <graphic>
                            <FontIcon iconLiteral="bi-file-earmark-plus" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Button fx:id="addFolderButton" text="Add Folder" onAction="#addFolder">
                        <graphic>
                            <FontIcon iconLiteral="bi-folder-plus" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Button fx:id="loadSampleXmlsButton" text="Load Sample XMLs" onAction="#loadSampleXmls">
                        <graphic>
                            <FontIcon iconLiteral="bi-lightbulb" iconColor="#ffc107" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Separator orientation="VERTICAL"/>
                    <Button fx:id="runAllTestsButton" text="Run All Tests" style="-fx-font-weight: bold;"
                            onAction="#runAllTests">
                        <graphic>
                            <FontIcon iconLiteral="bi-play-fill" iconColor="#28a745" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Button fx:id="testSingleFileButton" text="Test Single File" onAction="#testSingleFile">
                        <graphic>
                            <FontIcon iconLiteral="bi-play" iconSize="14"/>
                        </graphic>
                    </Button>
                </HBox>

                    <!-- Test Files Section -->
                    <VBox spacing="10">
                        <Label text="Test Files:" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                        <TableView fx:id="testFilesTable" prefHeight="200" style="-fx-font-size: 12px;">
                            <placeholder>
                                <VBox alignment="CENTER" spacing="10">
                                    <FontIcon iconLiteral="bi-inbox" iconColor="#ced4da" iconSize="32"/>
                                    <Label text="No test files added" style="-fx-text-fill: #6c757d;"/>
                                    <Button fx:id="addFirstXmlFileButton" text="Add First XML File"
                                            onAction="#addXmlFile">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-plus-circle" iconColor="#28a745" iconSize="14"/>
                                        </graphic>
                                    </Button>
                                </VBox>
                            </placeholder>
                            <columns>
                                <TableColumn text="Filename" prefWidth="200"/>
                                <TableColumn text="Status" prefWidth="100"/>
                                <TableColumn text="Rule Violations" prefWidth="100"/>
                                <TableColumn text="Warnings" prefWidth="100"/>
                                <TableColumn text="Actions" prefWidth="150"/>
                            </columns>
                        </TableView>

                        <HBox spacing="10">
                            <Button fx:id="addFileButton" text="Add File" onAction="#addXmlFile">
                                <graphic>
                                    <FontIcon iconLiteral="bi-plus-circle" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button fx:id="removeSelectedButton" text="Remove Selected" onAction="#removeSelected">
                                <graphic>
                                    <FontIcon iconLiteral="bi-dash-circle" iconColor="#dc3545" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button fx:id="removeAllButton" text="Remove All" onAction="#removeAll">
                                <graphic>
                                    <FontIcon iconLiteral="bi-trash" iconColor="#dc3545" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>
                    </VBox>

                    <!-- Test Results Section -->
                    <VBox spacing="10">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Test Results:" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Button fx:id="exportResultsButton" text="Export Results" onAction="#exportResults">
                                <graphic>
                                    <FontIcon iconLiteral="bi-download" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <TabPane prefHeight="300">
                            <Tab text="Overview" closable="false">
                                <ScrollPane fitToWidth="true" fitToHeight="true">
                                    <VBox spacing="10" style="-fx-padding: 10;">
                                        <!-- Summary will be displayed here -->
                                        <VBox alignment="CENTER" spacing="15">
                                            <FontIcon iconLiteral="bi-graph-up" iconColor="#6c757d" iconSize="48"/>
                                            <Label text="Run tests to see an overview of results"
                                                   style="-fx-text-fill: #6c757d; -fx-font-size: 14px;"/>
                                        </VBox>
                                    </VBox>
                                </ScrollPane>
                            </Tab>

                            <Tab text="Details" closable="false">
                                <ScrollPane fitToWidth="true" fitToHeight="true">
                                    <VBox spacing="10" style="-fx-padding: 10;">
                                        <!-- Detailed results will be displayed here -->
                                        <VBox alignment="CENTER" spacing="15">
                                            <FontIcon iconLiteral="bi-list-ul" iconColor="#6c757d" iconSize="48"/>
                                            <Label text="Detailed validation results will be displayed here"
                                                   style="-fx-text-fill: #6c757d; -fx-font-size: 14px;"/>
                                        </VBox>
                                    </VBox>
                                </ScrollPane>
                            </Tab>

                            <Tab text="Errors" closable="false">
                                <ScrollPane fitToWidth="true" fitToHeight="true">
                                    <VBox spacing="10" style="-fx-padding: 10;">
                                        <!-- Errors will be displayed here -->
                                        <VBox alignment="CENTER" spacing="15">
                                            <FontIcon iconLiteral="bi-exclamation-triangle" iconColor="#6c757d"
                                                      iconSize="48"/>
                                            <Label text="Validation errors and rule violations will be listed here"
                                                   style="-fx-text-fill: #6c757d; -fx-font-size: 14px;"/>
                                        </VBox>
                                    </VBox>
                                </ScrollPane>
                            </Tab>
                        </TabPane>
                    </VBox>

                    <!-- Testing Tips -->
                    <VBox spacing="10"
                          style="-fx-border-color: #d1ecf1; -fx-border-radius: 5; -fx-background-color: #d1ecf1; -fx-padding: 15;">
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <FontIcon iconLiteral="bi-lightbulb" iconColor="#0c5460" iconSize="20"/>
                            <Label text="Testing Tips:" style="-fx-font-weight: bold; -fx-text-fill: #0c5460;"/>
                        </HBox>
                        <VBox spacing="5">
                            <Label text="• Test both valid and invalid XML documents"
                                   style="-fx-text-fill: #0c5460; -fx-font-size: 12px;"/>
                            <Label text="• Create test cases for every edge case of your business rules"
                                   style="-fx-text-fill: #0c5460; -fx-font-size: 12px;"/>
                            <Label text="• Use meaningful filenames for your test XMLs"
                                   style="-fx-text-fill: #0c5460; -fx-font-size: 12px;"/>
                            <Label text="• Export test results for documentation"
                                   style="-fx-text-fill: #0c5460; -fx-font-size: 12px;"/>
                        </VBox>
                    </VBox>
            </VBox>
        </Tab>

        <!-- Documentation Tab -->
        <Tab fx:id="documentationTab" text="Documentation" closable="false">
            <graphic>
                <FontIcon iconLiteral="bi-book" iconColor="#16a34a" iconSize="16"/>
            </graphic>
            <org.fxt.freexmltoolkit.controls.SchematronDocumentationGenerator fx:id="docGenerator"/>
        </Tab>

    </TabPane>

</VBox>

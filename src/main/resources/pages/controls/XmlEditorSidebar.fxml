<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>
<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="org.fxt.freexmltoolkit.controller.controls.XmlEditorSidebarController"
      styleClass="xml-editor-sidebar" prefWidth="300" minWidth="250" maxWidth="400">

    <!-- Toggle Button -->
    <Button fx:id="toggleSidebarButton" text="◀" onAction="#toggleSidebar"
            styleClass="sidebar-toggle-button"
            maxWidth="Infinity" minHeight="30" prefHeight="30"/>

    <!-- Sidebar Content with ScrollPane -->
    <ScrollPane fx:id="sidebarScrollPane" styleClass="sidebar-scroll-pane" fitToWidth="true" VBox.vgrow="ALWAYS">
        <VBox fx:id="sidebarContent" spacing="0">

            <!-- ============================================ -->
            <!-- SECTION 1: Schema Validation                 -->
            <!-- ============================================ -->
            <HBox styleClass="sidebar-section-header" spacing="8" alignment="CENTER_LEFT">
                <padding><Insets top="16" right="10" bottom="8" left="10"/></padding>
                <FontIcon iconLiteral="bi-file-earmark-check" iconSize="14"/>
                <Label text="Schema Validation" style="-fx-font-weight: bold;"/>
            </HBox>

            <VBox styleClass="sidebar-section-container">
                <!-- XSD Schema TitledPane -->
                <TitledPane text="XSD Schema" styleClass="xml-sidebar-titled-pane" collapsible="true" expanded="true">
                    <VBox spacing="8">
                        <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>

                        <!-- XSD Path -->
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <TextField fx:id="xsdPathField" HBox.hgrow="ALWAYS"
                                       promptText="XSD Schema" editable="false" styleClass="cursor-info-field"/>
                            <Button fx:id="changeXsdButton" text="..." styleClass="sidebar-button"/>
                        </HBox>

                        <!-- Favorites Dropdown -->
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Label text="Favorites:" styleClass="cursor-info-label" prefWidth="55"/>
                            <ComboBox fx:id="xsdFavoritesComboBox" HBox.hgrow="ALWAYS"
                                      promptText="Select XSD from favorites" styleClass="sidebar-combo-box"/>
                            <Button fx:id="resetXsdButton" text="↺" prefWidth="25" maxWidth="25"
                                    styleClass="sidebar-button" style="-fx-font-size: 10px;">
                                <tooltip><Tooltip text="Reset to original XSD"/></tooltip>
                            </Button>
                        </HBox>

                        <!-- Validator Type -->
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Label text="Validator:" styleClass="cursor-info-label" prefWidth="55"/>
                            <ComboBox fx:id="validatorTypeComboBox" HBox.hgrow="ALWAYS"
                                      promptText="Select validator" styleClass="sidebar-combo-box">
                                <tooltip><Tooltip text="Choose XML validator (Xerces supports XSD 1.1 with assertions)"/></tooltip>
                            </ComboBox>
                        </HBox>

                        <!-- Validation Status -->
                        <Label fx:id="validationStatusLabel" text="Validation status: Unknown"
                               wrapText="true" styleClass="cursor-info-label"/>

                        <!-- Validation Controls -->
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <CheckBox fx:id="continuousValidationCheckBox" text="Continuous validation"
                                      styleClass="sidebar-checkbox"/>
                        </HBox>

                        <!-- XSD Documentation Toggle -->
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <ToggleButton fx:id="xsdDocumentationToggleButton" text="XSD Comments"
                                          onAction="#toggleXsdDocumentationComments" styleClass="sidebar-button">
                                <graphic><FontIcon iconLiteral="bi-journal-text" iconSize="12"/></graphic>
                                <tooltip><Tooltip text="Toggle XSD documentation as XML comments"/></tooltip>
                            </ToggleButton>
                            <Label fx:id="xsdCommentsStatusLabel" text="" styleClass="cursor-info-label"/>
                        </HBox>
                    </VBox>
                </TitledPane>

                <!-- Validation Errors TitledPane (hidden when no errors) -->
                <TitledPane text="Validation Errors" styleClass="xml-sidebar-titled-pane"
                            collapsible="true" expanded="true" fx:id="validationErrorsPane"
                            visible="false" managed="false">
                    <VBox spacing="5">
                        <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                        <Label fx:id="validationErrorsCountLabel" text="Validation Errors (0)"
                               style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <ListView fx:id="validationErrorsListView" styleClass="sidebar-list-view validation-errors-list"
                                  prefHeight="120" maxHeight="150">
                            <placeholder><Label text="No validation errors"/></placeholder>
                        </ListView>
                    </VBox>
                </TitledPane>
            </VBox>

            <!-- ============================================ -->
            <!-- SECTION 2: Business Rules                    -->
            <!-- ============================================ -->
            <HBox styleClass="sidebar-section-header" spacing="8" alignment="CENTER_LEFT">
                <padding><Insets top="16" right="10" bottom="8" left="10"/></padding>
                <FontIcon iconLiteral="bi-shield-check" iconSize="14"/>
                <Label text="Business Rules" style="-fx-font-weight: bold;"/>
            </HBox>

            <VBox styleClass="sidebar-section-container">
                <!-- Schematron Rules TitledPane -->
                <TitledPane text="Schematron Rules" styleClass="xml-sidebar-titled-pane"
                            collapsible="true" expanded="false">
                    <VBox spacing="8">
                        <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>

                        <!-- Schematron Path -->
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <TextField fx:id="schematronPathField" HBox.hgrow="ALWAYS"
                                       promptText="Schematron Rules" editable="false" styleClass="cursor-info-field"/>
                            <Button fx:id="changeSchematronButton" text="..." styleClass="sidebar-button"/>
                        </HBox>

                        <!-- Schematron Status -->
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Label fx:id="schematronValidationStatusLabel"
                                   text="Schematron validation status: Unknown"
                                   wrapText="true" HBox.hgrow="ALWAYS" styleClass="cursor-info-label"/>
                            <Button fx:id="schematronDetailsButton" text="Details" visible="false"
                                    onAction="#showSchematronDetails" prefWidth="55"
                                    styleClass="sidebar-button" style="-fx-font-size: 10px;"/>
                        </HBox>

                        <!-- Continuous Schematron Validation -->
                        <CheckBox fx:id="continuousSchematronValidationCheckBox"
                                  text="Continuous Schematron validation" styleClass="sidebar-checkbox"/>
                    </VBox>
                </TitledPane>

                <!-- Schematron Errors TitledPane (hidden when no errors) -->
                <TitledPane text="Schematron Errors" styleClass="xml-sidebar-titled-pane"
                            collapsible="true" expanded="true" fx:id="schematronErrorsPane"
                            visible="false" managed="false">
                    <VBox spacing="5">
                        <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                        <Label fx:id="schematronErrorsCountLabel" text="Schematron Errors (0)"
                               style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <ListView fx:id="schematronErrorsListView" styleClass="sidebar-list-view schematron-errors-list"
                                  prefHeight="120" maxHeight="150">
                            <placeholder><Label text="No Schematron errors"/></placeholder>
                        </ListView>
                    </VBox>
                </TitledPane>
            </VBox>

            <!-- ============================================ -->
            <!-- SECTION 3: Document Structure                -->
            <!-- ============================================ -->
            <HBox styleClass="sidebar-section-header" spacing="8" alignment="CENTER_LEFT">
                <padding><Insets top="16" right="10" bottom="8" left="10"/></padding>
                <FontIcon iconLiteral="bi-diagram-3" iconSize="14"/>
                <Label text="Document Structure" style="-fx-font-weight: bold;"/>
            </HBox>

            <VBox styleClass="sidebar-section-container">
                <TitledPane text="XML Tree" styleClass="xml-sidebar-titled-pane" collapsible="true" expanded="true">
                    <VBox spacing="5">
                        <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                        <HBox spacing="5" alignment="CENTER_LEFT">
                            <Button fx:id="expandAllButton" text="Expand All" styleClass="sidebar-button" style="-fx-font-size: 10px;">
                                <graphic><FontIcon iconLiteral="bi-arrows-expand" iconSize="12"/></graphic>
                            </Button>
                            <Button fx:id="collapseAllButton" text="Collapse All" styleClass="sidebar-button" style="-fx-font-size: 10px;">
                                <graphic><FontIcon iconLiteral="bi-arrows-collapse" iconSize="12"/></graphic>
                            </Button>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="refreshTreeButton" text="" styleClass="sidebar-button" prefWidth="25" maxWidth="25">
                                <graphic><FontIcon iconLiteral="bi-arrow-clockwise" iconSize="12"/></graphic>
                                <tooltip><Tooltip text="Refresh tree"/></tooltip>
                            </Button>
                        </HBox>
                        <TreeView fx:id="documentTreeView" styleClass="sidebar-tree-view" prefHeight="200" VBox.vgrow="ALWAYS"/>
                    </VBox>
                </TitledPane>
            </VBox>

            <!-- ============================================ -->
            <!-- SECTION 4: Code Assistance (XSD-dependent)   -->
            <!-- ============================================ -->
            <HBox styleClass="sidebar-section-header" spacing="8" alignment="CENTER_LEFT">
                <padding><Insets top="16" right="10" bottom="8" left="10"/></padding>
                <FontIcon iconLiteral="bi-lightbulb" iconSize="14"/>
                <Label text="Code Assistance" style="-fx-font-weight: bold;"/>
            </HBox>

            <VBox fx:id="codeAssistanceSection" styleClass="sidebar-section-container">

                <!-- Cursor Information (partially XSD-dependent) -->
                <StackPane fx:id="cursorInfoStack">
                    <TitledPane fx:id="cursorInfoPane" text="Cursor Information"
                                styleClass="xml-sidebar-titled-pane" collapsible="true" expanded="true">
                        <VBox spacing="6">
                            <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                            <Label text="XPath:" styleClass="cursor-info-label"/>
                            <TextField fx:id="xpathField" editable="false" styleClass="cursor-info-field"
                                       promptText="XPath will appear here..."/>
                            <Label text="Node Name:" styleClass="cursor-info-label"/>
                            <TextField fx:id="elementNameField" editable="false" styleClass="cursor-info-field"
                                       promptText="Node name will appear here..."/>
                            <Label text="Element Type:" styleClass="cursor-info-label"/>
                            <TextField fx:id="elementTypeField" editable="false" styleClass="cursor-info-field"
                                       promptText="Element type will appear here..."/>
                        </VBox>
                    </TitledPane>
                </StackPane>

                <!-- Node Documentation (XSD-dependent - hidden when no XSD) -->
                <StackPane fx:id="documentationStack">
                    <TitledPane fx:id="documentationPane" text="Node Documentation"
                                styleClass="xml-sidebar-titled-pane" collapsible="true" expanded="false">
                        <VBox spacing="5">
                            <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                            <TextArea fx:id="documentationTextArea" prefRowCount="3" editable="false"
                                      wrapText="true" styleClass="documentation-text-area"
                                      promptText="Node documentation will appear here..."/>
                        </VBox>
                    </TitledPane>
                </StackPane>

                <!-- Example Values (XSD-dependent - hidden when no XSD) -->
                <StackPane fx:id="exampleValuesStack">
                    <TitledPane fx:id="exampleValuesPane" text="Example Values"
                                styleClass="xml-sidebar-titled-pane" collapsible="true" expanded="false">
                        <VBox spacing="5">
                            <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                            <ListView fx:id="exampleValuesListView" styleClass="sidebar-list-view"
                                      prefHeight="80">
                                <placeholder><Label text="Example values will appear here..."/></placeholder>
                            </ListView>
                        </VBox>
                    </TitledPane>
                </StackPane>

                <!-- Possible Child Elements (XSD-dependent - hidden when no XSD) -->
                <StackPane fx:id="childElementsStack" VBox.vgrow="ALWAYS">
                    <TitledPane fx:id="childElementsPane" text="Possible Child Elements"
                                styleClass="xml-sidebar-titled-pane" collapsible="true" expanded="true"
                                VBox.vgrow="ALWAYS">
                        <VBox spacing="5" VBox.vgrow="ALWAYS">
                            <padding><Insets bottom="5" left="5" right="5" top="5"/></padding>
                            <ListView fx:id="childElementsListView" styleClass="sidebar-list-view"
                                      VBox.vgrow="ALWAYS">
                                <placeholder><Label text="Child elements will appear here..."/></placeholder>
                            </ListView>
                        </VBox>
                    </TitledPane>
                </StackPane>
            </VBox>

        </VBox>
    </ScrollPane>

</VBox>

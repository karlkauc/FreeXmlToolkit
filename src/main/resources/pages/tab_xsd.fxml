<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ FreeXMLToolkit - Universal Toolkit for XML
  ~ Copyright (c) Karl Kauc 2024.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  ~
  -->

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>
<?import org.fxmisc.flowless.VirtualizedScrollPane?>
<?import org.fxmisc.richtext.CodeArea?>
<?import org.kordamp.ikonli.javafx.*?>
<VBox AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0" AnchorPane.rightAnchor="0"
      AnchorPane.topAnchor="0" xmlns="http://javafx.com/javafx/11.0.14-internal" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="org.fxt.freexmltoolkit.controller.XsdController" stylesheets="@../css/xsd-tab-groups.css">

    <!-- XSD Operations Toolbar -->
    <ToolBar styleClass="xsd-toolbar">
        <!-- File Operations -->
        <Button fx:id="toolbarNewFile" text="New" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarNewFile">
            <graphic>
                <FontIcon iconLiteral="bi-file-earmark-plus" iconSize="20" iconColor="#28a745" styleClass="toolbar-icon-success"/>
            </graphic>
            <tooltip>
                <Tooltip text="New XSD File"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarLoadFile" text="Open" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarLoadFile">
            <graphic>
                <FontIcon iconLiteral="bi-folder2-open" iconSize="20" iconColor="#007bff" styleClass="toolbar-icon-primary"/>
            </graphic>
            <tooltip>
                <Tooltip text="Load XSD File"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarSave" text="Save" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarSave">
            <graphic>
                <FontIcon iconLiteral="bi-save" iconSize="20" iconColor="#17a2b8" styleClass="toolbar-icon-info"/>
            </graphic>
            <tooltip>
                <Tooltip text="Save (Ctrl+S)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarSaveAs" text="Save As" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarSaveAs">
            <graphic>
                <FontIcon iconLiteral="bi-save-fill" iconSize="20" iconColor="#17a2b8" styleClass="toolbar-icon-info"/>
            </graphic>
            <tooltip>
                <Tooltip text="Save As (Ctrl+Shift+S)"/>
            </tooltip>
        </Button>

        <Separator orientation="VERTICAL"/>

        <Button fx:id="toolbarReload" text="Reload" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarReload">
            <graphic>
                <FontIcon iconLiteral="bi-arrow-clockwise" iconSize="20" iconColor="#6c757d" styleClass="toolbar-icon-secondary"/>
            </graphic>
            <tooltip>
                <Tooltip text="Reload from Disk (Ctrl+R)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarClose" text="Close" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarClose">
            <graphic>
                <FontIcon iconLiteral="bi-x-circle" iconSize="20" iconColor="#dc3545" styleClass="toolbar-icon-danger"/>
            </graphic>
            <tooltip>
                <Tooltip text="Close File (Ctrl+W)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarValidate" text="Validate" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarValidate">
            <graphic>
                <FontIcon iconLiteral="bi-check-circle" iconSize="20" iconColor="#28a745" styleClass="toolbar-icon-success"/>
            </graphic>
            <tooltip>
                <Tooltip text="Validate XSD Schema (F5)"/>
            </tooltip>
        </Button>

        <Separator orientation="VERTICAL"/>

        <!-- Editing Operations -->
        <Button fx:id="toolbarUndo" text="Undo" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarUndo">
            <graphic>
                <FontIcon iconLiteral="bi-arrow-counterclockwise" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Undo (Ctrl+Z)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarRedo" text="Redo" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarRedo">
            <graphic>
                <FontIcon iconLiteral="bi-arrow-clockwise" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Redo (Ctrl+Y)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarFind" text="Find" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarFind">
            <graphic>
                <FontIcon iconLiteral="bi-search" iconSize="20" iconColor="#6f42c1" styleClass="toolbar-icon-purple"/>
            </graphic>
            <tooltip>
                <Tooltip text="Find/Replace (Ctrl+F)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarFormat" text="Format" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarFormat">
            <graphic>
                <FontIcon iconLiteral="bi-code-square" iconSize="20" iconColor="#20c997" styleClass="toolbar-icon-teal"/>
            </graphic>
            <tooltip>
                <Tooltip text="Format/Pretty Print (Ctrl+Alt+F)"/>
            </tooltip>
        </Button>

        <Separator orientation="VERTICAL"/>

        <!-- Favorites & Recent -->
        <Button fx:id="toolbarAddFavorite" text="Add Favorite" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarAddFavorite">
            <graphic>
                <FontIcon iconLiteral="bi-star" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Add to Favorites (Ctrl+D)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarShowFavorites" text="Favorites" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarShowFavorites">
            <graphic>
                <FontIcon iconLiteral="bi-star-fill" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Show/Hide Favorites (Ctrl+Shift+D)"/>
            </tooltip>
        </Button>

        <Button fx:id="toolbarXPathQuery" text="XPath" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarXPathQuery">
            <graphic>
                <FontIcon iconLiteral="bi-braces" iconSize="20" iconColor="#6f42c1" styleClass="toolbar-icon-purple"/>
            </graphic>
            <tooltip>
                <Tooltip text="Toggle XPath/XQuery Panel (Ctrl+Q)"/>
            </tooltip>
        </Button>

        <MenuButton fx:id="toolbarRecentFiles" text="Recent" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-clock-history" iconSize="20" iconColor="#6c757d" styleClass="toolbar-icon-secondary"/>
            </graphic>
            <tooltip>
                <Tooltip text="Recent Files (Ctrl+Shift+R)"/>
            </tooltip>
        </MenuButton>

        <Region HBox.hgrow="ALWAYS"/>

        <!-- Help -->
        <Button fx:id="toolbarHelp" text="Help" contentDisplay="TOP" styleClass="toolbar-button" onAction="#handleToolbarHelp">
            <graphic>
                <FontIcon iconLiteral="bi-question-circle" iconSize="20" iconColor="#17a2b8" styleClass="toolbar-icon-info"/>
            </graphic>
            <tooltip>
                <Tooltip text="Help/Overview (Ctrl+H / F1)"/>
            </tooltip>
        </Button>
    </ToolBar>

    <TabPane fx:id="tabPane" VBox.vgrow="ALWAYS">
        <Tab fx:id="xsdTab" text="Graphic View" styleClass="primary-tab" closable="false">
            <tooltip>
                <Tooltip text="Visual XSD Editor - Interactive schema design (Ctrl+1)"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-diagram-2"/>
            </graphic>
            <BorderPane>
                <!-- Schema Information panel removed - now integrated in Properties Panel -->
                <center>
                    <SplitPane fx:id="graphicTabSplitPane" orientation="HORIZONTAL" dividerPositions="0.75">
                        <items>
                            <!-- Main content area with visualization options -->
                            <VBox style="-fx-background-color: #f8f9fa;">
                                <children>
                                    <!-- Visualization Selection Toolbar -->

                                    <!-- Content Area -->
                                    <StackPane VBox.vgrow="ALWAYS">
                                        <children>
                                            <VBox fx:id="noFileLoadedPane" alignment="CENTER" spacing="20.0">
                                                <children>
                                                    <FontIcon iconColor="#ced4da" iconLiteral="bi-file-earmark-x"
                                                              iconSize="64"/>
                                                    <Label style="-fx-font-size: 18px; -fx-text-fill: #6c757d;"
                                                           text="No XSD file loaded"/>
                                                    <Label style="-fx-text-fill: #6c757d;"
                                                           text="Please load an XSD file to see the graphical representation."/>
                                                    <HBox alignment="CENTER" spacing="10">
                                                        <Button onAction="#createNewXsdFile" styleClass="button"
                                                                text="New XSD File">
                                                            <graphic>
                                                                <FontIcon iconLiteral="bi-file-plus"
                                                                          iconColor="#28a745"/>
                                                            </graphic>
                                                        </Button>
                                                        <Button onAction="#openXsdFileChooser"
                                                                styleClass="button, :default"
                                                                text="Load XSD File">
                                                            <graphic>
                                                                <FontIcon iconLiteral="bi-folder2-open"/>
                                                            </graphic>
                                                        </Button>
                                                    </HBox>
                                                </children>
                                            </VBox>

                                            <!-- V1 Editor Container (Current/Legacy) -->
                                            <StackPane fx:id="xsdStackPane" visible="false" managed="false"/>

                                            <!-- V2 Editor Container (New/Beta) -->
                                            <StackPane fx:id="xsdStackPaneV2" visible="false" managed="false"
                                                       style="-fx-background-color: white;">
                                                <!-- V2 Editor content will be added dynamically -->
                                            </StackPane>

                                            <ProgressIndicator fx:id="xsdDiagramProgress" maxHeight="80" maxWidth="80"
                                                               visible="false"/>
                                        </children>
                                    </StackPane>
                                </children>
                            </VBox>

                            <!-- Favorites Panel for Graphic Tab -->
                            <fx:include fx:id="favoritesPanelGraphic" source="controls/FavoritesPanel.fxml"/>
                        </items>
                    </SplitPane>
                </center>
            </BorderPane>
        </Tab>
        <Tab fx:id="typeLibraryTab" text="Type Library" styleClass="primary-tab" closable="false">
            <tooltip>
                <Tooltip text="Type Library - Browse and analyze all types (Ctrl+2)"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-collection"/>
            </graphic>
            <content>
                <StackPane fx:id="typeLibraryStackPane" style="-fx-background-color: #fafafa;">
                    <!-- No File Loaded View -->
                    <VBox fx:id="noFileLoadedPaneTypeLibrary" alignment="CENTER" spacing="20.0">
                        <children>
                            <FontIcon iconColor="#ced4da" iconLiteral="bi-file-earmark-x"
                                      iconSize="64"/>
                            <Label style="-fx-font-size: 18px; -fx-text-fill: #6c757d;"
                                   text="No XSD file loaded"/>
                            <Label style="-fx-text-fill: #6c757d;"
                                   text="Please load an XSD file to browse types."/>
                            <HBox alignment="CENTER" spacing="10">
                                <Button onAction="#createNewXsdFile" styleClass="button"
                                        text="New XSD File">
                                    <graphic>
                                        <FontIcon iconLiteral="bi-file-plus"
                                                  iconColor="#28a745"/>
                                    </graphic>
                                </Button>
                                <Button onAction="#openXsdFileChooser"
                                        styleClass="button, :default"
                                        text="Load XSD File">
                                    <graphic>
                                        <FontIcon iconLiteral="bi-folder2-open"/>
                                    </graphic>
                                </Button>
                            </HBox>
                        </children>
                    </VBox>
                    <!-- Type library panel will be dynamically added here -->
                </StackPane>
            </content>
        </Tab>
        <Tab fx:id="typeEditorTab" text="Type Editor" styleClass="primary-tab" closable="false">
            <tooltip>
                <Tooltip text="Type Editor - Edit ComplexTypes and SimpleTypes"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-pencil-square"/>
            </graphic>
            <content>
                <StackPane fx:id="typeEditorStackPane" style="-fx-background-color: #fafafa;">
                    <!-- No File Loaded View -->
                    <VBox fx:id="noFileLoadedPaneTypeEditor" alignment="CENTER" spacing="20.0">
                        <children>
                            <FontIcon iconColor="#ced4da" iconLiteral="bi-file-earmark-x"
                                      iconSize="64"/>
                            <Label style="-fx-font-size: 18px; -fx-text-fill: #6c757d;"
                                   text="No XSD file loaded"/>
                            <Label style="-fx-text-fill: #6c757d;"
                                   text="Please load an XSD file to edit types."/>
                            <HBox alignment="CENTER" spacing="10">
                                <Button onAction="#createNewXsdFile" styleClass="button"
                                        text="New XSD File">
                                    <graphic>
                                        <FontIcon iconLiteral="bi-file-plus"
                                                  iconColor="#28a745"/>
                                    </graphic>
                                </Button>
                                <Button onAction="#openXsdFileChooser"
                                        styleClass="button, :default"
                                        text="Load XSD File">
                                    <graphic>
                                        <FontIcon iconLiteral="bi-folder2-open"/>
                                    </graphic>
                                </Button>
                            </HBox>
                        </children>
                    </VBox>
                    <!-- Type editor TabPane will be dynamically added here -->
                </StackPane>
            </content>
        </Tab>
        <Tab fx:id="textTab" text="Text View" styleClass="primary-tab" closable="false">
            <tooltip>
                <Tooltip text="Source Code View - Raw XSD editing (Ctrl+3)"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-card-text"/>
            </graphic>
            <BorderPane>
                <top>
                    <HBox fx:id="textInfoPane" alignment="CENTER_LEFT" managed="false" spacing="15.0"
                          style="-fx-padding: 10; -fx-background-color: #f1f3f5; -fx-border-width: 0 0 1 0; -fx-border-color: #dee2e6;"
                          visible="false">
                        <children>
                            <VBox spacing="5.0">
                                <children>
                                    <HBox alignment="CENTER_LEFT" spacing="10.0">
                                        <children>
                                            <Label style="-fx-font-weight: bold;" text="File Path:"/>
                                            <Label fx:id="textInfoPathLabel"/>
                                        </children>
                                    </HBox>
                                </children>
                            </VBox>
                        </children>
                    </HBox>
                </top>
                <center>
                    <SplitPane fx:id="textTabSplitPane" orientation="HORIZONTAL" dividerPositions="0.75">
                        <items>
                            <!-- Main content area with vertical split for XPath panel -->
                            <SplitPane fx:id="textContentSplitPane" orientation="VERTICAL" dividerPositions="1.0">
                                <items>
                                    <!-- Source code editor area -->
                                    <StackPane style="-fx-background-color: #f8f9fa;">
                                        <children>
                                            <VBox fx:id="noFileLoadedPaneText" alignment="CENTER" spacing="20.0">
                                                <children>
                                                    <FontIcon iconColor="#ced4da" iconLiteral="bi-file-earmark-x"
                                                              iconSize="64"/>
                                                    <Label style="-fx-font-size: 18px; -fx-text-fill: #6c757d;"
                                                           text="No XSD file loaded"/>
                                                    <Label style="-fx-text-fill: #6c757d;"
                                                           text="Please load an XSD file to see the source code."/>
                                                    <HBox alignment="CENTER" spacing="10">
                                                        <Button onAction="#createNewXsdFile" styleClass="button"
                                                                text="New XSD File">
                                                            <graphic>
                                                                <FontIcon iconLiteral="bi-file-plus" iconColor="#28a745"/>
                                                            </graphic>
                                                        </Button>
                                                        <Button onAction="#openXsdFileChooser" styleClass="button, :default"
                                                                text="Load XSD File">
                                                            <graphic>
                                                                <FontIcon iconLiteral="bi-folder2-open"/>
                                                            </graphic>
                                                        </Button>
                                                    </HBox>
                                                </children>
                                            </VBox>
                                            <VBox fx:id="sourceCodeEditorContainer" managed="false" visible="false"/>
                                            <ProgressIndicator fx:id="textProgress" maxHeight="80" maxWidth="80"
                                                               visible="false"/>
                                        </children>
                                    </StackPane>

                                    <!-- XPath/XQuery Query Panel (initially hidden, added programmatically) -->
                                    <VBox fx:id="xpathQueryPanel" managed="false" visible="false"
                                          style="-fx-background-color: #ffffff; -fx-border-color: #dee2e6; -fx-border-width: 1 0 0 0;">
                                    </VBox>
                                </items>
                            </SplitPane>

                            <!-- Favorites Panel -->
                            <fx:include fx:id="favoritesPanel" source="controls/FavoritesPanel.fxml"/>
                        </items>
                    </SplitPane>
                </center>
            </BorderPane>
        </Tab>
        <Tab fx:id="schemaAnalysisTab" text="Schema Analysis" styleClass="primary-tab" closable="false">
            <tooltip>
                <Tooltip text="Schema Analysis - Statistics, Constraints, Validation, Quality Checks"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-clipboard-data"/>
            </graphic>
            <content>
                <StackPane fx:id="schemaAnalysisStackPane" style="-fx-background-color: #fafafa;">
                    <!-- Schema analysis pane will be dynamically added here -->
                    <VBox alignment="CENTER" spacing="20.0">
                        <children>
                            <FontIcon iconColor="#ced4da" iconLiteral="bi-clipboard-data" iconSize="64"/>
                            <Label style="-fx-font-size: 18px; -fx-text-fill: #6c757d;"
                                   text="No XSD file loaded"/>
                            <Label style="-fx-text-fill: #6c757d;"
                                   text="Load an XSD schema to view analysis and statistics."/>
                        </children>
                    </VBox>
                </StackPane>
            </content>
        </Tab>
        <Tab fx:id="documentation" text="Documentation" styleClass="output-tab" closable="false">
            <tooltip>
                <Tooltip text="Documentation Generator - Create HTML docs (Ctrl+4)"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-journal-text" iconSize="16"/>
            </graphic>

            <ScrollPane fitToWidth="true" fitToHeight="true" style="-fx-background-color: #e8ecf0; -fx-background: #e8ecf0;">
                <VBox spacing="20" style="-fx-padding: 30 30 50 30; -fx-background-color: #e8ecf0;">

                    <!-- Header Section -->
                    <VBox spacing="8">
                        <Label text="Documentation Generator Settings"
                               style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>
                        <Label text="Configure options to generate comprehensive HTML documentation from your XSD files."
                               style="-fx-font-size: 14px; -fx-text-fill: #5a6270;" wrapText="true"/>
                    </VBox>

                    <!-- Top Row: Source & Destination (full width) -->
                    <VBox spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                        <Label text="Source &amp; Destination"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>

                        <HBox spacing="20">
                            <VBox spacing="6" HBox.hgrow="ALWAYS">
                                <Label text="XSD File:" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <HBox spacing="8">
                                    <TextField fx:id="xsdFilePath" promptText="Load an XSD file..." HBox.hgrow="ALWAYS"
                                               style="-fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db; -fx-padding: 8 12;"/>
                                    <Button onAction="#openXsdFileChooser" style="-fx-background-color: #f3f4f6; -fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db; -fx-padding: 8 12;">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-folder2-open" iconSize="16" iconColor="#6b7280"/>
                                        </graphic>
                                    </Button>
                                </HBox>
                            </VBox>

                            <VBox spacing="6" HBox.hgrow="ALWAYS">
                                <Label text="Output Folder:" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <HBox spacing="8">
                                    <TextField fx:id="documentationOutputDirPath" promptText="Select an output directory..." HBox.hgrow="ALWAYS"
                                               style="-fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db; -fx-padding: 8 12;"/>
                                    <Button onAction="#openOutputFolderDialog" style="-fx-background-color: #f3f4f6; -fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db; -fx-padding: 8 12;">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-folder2-open" iconSize="16" iconColor="#6b7280"/>
                                        </graphic>
                                    </Button>
                                </HBox>
                            </VBox>
                        </HBox>

                        <!-- Hidden XSD Drop Zone -->
                        <VBox fx:id="xsdPane" accessibleText="XSD File" alignment="CENTER" managed="false" visible="false"
                              style="-fx-background-color: #f9fafb; -fx-background-radius: 8; -fx-border-radius: 8; -fx-border-color: #d1d5db; -fx-border-style: dashed; -fx-padding: 20;">
                            <Label text="Drop XSD file here" style="-fx-text-fill: #9ca3af;"/>
                        </VBox>
                    </VBox>

                    <!-- Middle Row: General Settings | Language Settings -->
                    <HBox spacing="20" HBox.hgrow="ALWAYS">
                        <!-- General Settings Card (shared across all formats) -->
                        <VBox fx:id="generalSettingsContainer" spacing="12" HBox.hgrow="ALWAYS"
                              style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                            <Label text="General Settings"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>

                            <CheckBox fx:id="openFileAfterCreation" selected="true" text="Open file after creation">
                                <tooltip>
                                    <Tooltip text="Automatically open the generated documentation after creation"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="createExampleData" selected="true" text="Create example data if missing">
                                <tooltip>
                                    <Tooltip text="Generate example values for elements without sample data"/>
                                </tooltip>
                            </CheckBox>
                        </VBox>

                        <!-- Language Settings Card -->
                        <VBox spacing="12" HBox.hgrow="ALWAYS"
                              style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                            <Label text="Language Settings"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>

                            <VBox spacing="6">
                                <Label text="Language Filter:" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <HBox spacing="10" alignment="CENTER_LEFT">
                                    <HBox fx:id="languageSelectionContainer" spacing="10" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                        <!-- CheckComboBox added programmatically -->
                                    </HBox>
                                    <Button fx:id="scanLanguagesButton" onAction="#scanForLanguages" text="Scan Languages"
                                            style="-fx-background-color: #4a90d9; -fx-text-fill: white; -fx-background-radius: 6; -fx-padding: 8 16; -fx-font-weight: bold;">
                                        <tooltip>
                                            <Tooltip text="Scan the XSD file to discover available documentation languages"/>
                                        </tooltip>
                                    </Button>
                                </HBox>
                            </VBox>

                            <Label fx:id="languageScanStatus" text="Languages will be detected automatically"
                                   style="-fx-text-fill: #6b7280; -fx-font-size: 12px;"/>

                            <HBox fx:id="languageQuickActions" spacing="10" visible="false" managed="false">
                                <Button onAction="#selectAllLanguages" text="Select All"
                                        style="-fx-background-color: #f3f4f6; -fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db; -fx-padding: 6 12;"/>
                                <Button onAction="#deselectAllLanguages" text="Deselect All"
                                        style="-fx-background-color: #f3f4f6; -fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db; -fx-padding: 6 12;"/>
                            </HBox>

                            <HBox fx:id="fallbackLanguageContainer" spacing="10" alignment="CENTER_LEFT"
                                  visible="false" managed="false">
                                <Label text="Fallback Language:" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <ComboBox fx:id="fallbackLanguageComboBox" prefWidth="150"
                                          style="-fx-background-radius: 6;">
                                    <tooltip>
                                        <Tooltip text="Select the fallback language to use when 'default' (no language tag) documentation is not available"/>
                                    </tooltip>
                                </ComboBox>
                            </HBox>
                        </VBox>
                    </HBox>

                    <!-- Output Options and Format-Specific Settings Row -->
                    <HBox spacing="20" HBox.hgrow="ALWAYS">

                        <!-- Output Options Card -->
                        <VBox spacing="15" prefWidth="280"
                              style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                            <Label text="Output Options"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>

                            <VBox spacing="6">
                                <fx:define>
                                    <ToggleGroup fx:id="outputFormatGroup"/>
                                </fx:define>
                                <Label text="Output Format:" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <VBox spacing="8">
                                    <RadioButton fx:id="outputFormatHtml" selected="true" text="HTML" toggleGroup="$outputFormatGroup">
                                        <tooltip>
                                            <Tooltip text="Generate HTML documentation with navigation and search"/>
                                        </tooltip>
                                    </RadioButton>
                                    <RadioButton fx:id="outputFormatWord" text="Word" toggleGroup="$outputFormatGroup">
                                        <tooltip>
                                            <Tooltip text="Generate Microsoft Word (.docx) document"/>
                                        </tooltip>
                                    </RadioButton>
                                    <RadioButton fx:id="outputFormatPdf" text="PDF" toggleGroup="$outputFormatGroup">
                                        <tooltip>
                                            <Tooltip text="Generate PDF document using Apache FOP"/>
                                        </tooltip>
                                    </RadioButton>
                                </VBox>
                            </VBox>

                            <CheckBox fx:id="showDocumentationInSvg" selected="false" text="Show documentation in SVG">
                                <tooltip>
                                    <Tooltip text="Show documentation of the root element below the SVG diagram"/>
                                </tooltip>
                            </CheckBox>
                        </VBox>

                        <!-- HTML-Specific Settings Card (visible when HTML is selected) -->
                        <VBox fx:id="htmlSettingsContainer" spacing="12" HBox.hgrow="ALWAYS"
                              style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <FontIcon iconLiteral="bi-file-earmark-code" iconSize="20" iconColor="#E34F26"/>
                                <Label text="HTML Options"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>
                            </HBox>

                            <VBox spacing="6">
                                <Label text="Grafik format:" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <ChoiceBox fx:id="grafikFormat" value="SVG" prefWidth="200"
                                           style="-fx-background-radius: 6;"/>
                            </VBox>

                            <CheckBox fx:id="useMarkdownRenderer" selected="true" text="Use Markdown Renderer">
                                <tooltip>
                                    <Tooltip text="Render Markdown formatting in documentation text"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="includeTypeDefinitionsInSourceCode" selected="true" text="Include type definitions in source code">
                                <tooltip>
                                    <Tooltip text="Include referenced type definitions in the source code sections"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="generateSvgOverviewPage" selected="true" text="Generate SVG overview page">
                                <tooltip>
                                    <Tooltip text="Generate an interactive SVG page showing the complete schema structure"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="addMetadataInOutput" selected="true" text="Add Metadata in Output">
                                <tooltip>
                                    <Tooltip text="Add HTML comments with creation details (timestamp, OS, app version) to all generated HTML files"/>
                                </tooltip>
                            </CheckBox>

                            <Separator style="-fx-padding: 5 0;"/>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Favicon:" prefWidth="100" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <TextField fx:id="faviconPath" HBox.hgrow="ALWAYS" promptText="Optional: Path to favicon file (.ico, .png, .svg)"/>
                                <Button fx:id="browseFaviconButton" onAction="#handleBrowseFavicon">
                                    <graphic>
                                        <FontIcon iconLiteral="bi-folder2-open" iconSize="16"/>
                                    </graphic>
                                    <tooltip>
                                        <Tooltip text="Browse for favicon file"/>
                                    </tooltip>
                                </Button>
                            </HBox>
                        </VBox>

                        <!-- Word-Specific Settings Card (hidden by default) -->
                        <VBox fx:id="wordSettingsContainer" spacing="12" HBox.hgrow="ALWAYS"
                              visible="false" managed="false"
                              style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <FontIcon iconLiteral="bi-file-earmark-richtext" iconSize="20" iconColor="#2B579A"/>
                                <Label text="Word Options"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>
                            </HBox>

                            <fx:define>
                                <ToggleGroup fx:id="wordOrientationGroup"/>
                            </fx:define>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Page Size:" prefWidth="100" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <ChoiceBox fx:id="wordPageSize" prefWidth="120" style="-fx-background-radius: 6;">
                                    <tooltip>
                                        <Tooltip text="Select the page size for the Word document"/>
                                    </tooltip>
                                </ChoiceBox>
                            </HBox>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Orientation:" prefWidth="100" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <RadioButton fx:id="wordOrientationPortrait" text="Portrait" selected="true" toggleGroup="$wordOrientationGroup"/>
                                <RadioButton fx:id="wordOrientationLandscape" text="Landscape" toggleGroup="$wordOrientationGroup"/>
                            </HBox>

                            <Separator style="-fx-padding: 5 0;"/>

                            <CheckBox fx:id="wordIncludeCoverPage" selected="false" text="Include Cover Page">
                                <tooltip>
                                    <Tooltip text="Add a title page with schema name and metadata"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="wordIncludeToc" selected="true" text="Include Table of Contents">
                                <tooltip>
                                    <Tooltip text="Generate a table of contents"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="wordIncludeDataDictionary" selected="true" text="Include Data Dictionary">
                                <tooltip>
                                    <Tooltip text="Include the data dictionary table"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="wordIncludeSchemaDiagram" selected="true" text="Include Schema Diagram">
                                <tooltip>
                                    <Tooltip text="Embed the main schema diagram as an image"/>
                                </tooltip>
                            </CheckBox>
                            <CheckBox fx:id="wordIncludeElementDiagrams" selected="false" text="Include Element Diagrams">
                                <tooltip>
                                    <Tooltip text="Embed SVG diagrams for each element in the Data Dictionary"/>
                                </tooltip>
                            </CheckBox>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Header Style:" prefWidth="100" style="-fx-font-size: 13px; -fx-text-fill: #374151;"/>
                                <ChoiceBox fx:id="wordHeaderStyle" prefWidth="150" style="-fx-background-radius: 6;">
                                    <tooltip>
                                        <Tooltip text="Select the header style for sections"/>
                                    </tooltip>
                                </ChoiceBox>
                            </HBox>
                        </VBox>

                        <!-- PDF-Specific Settings Card (hidden by default) -->
                        <VBox fx:id="pdfSettingsContainer" spacing="12" HBox.hgrow="ALWAYS"
                              visible="false" managed="false"
                              style="-fx-background-color: white; -fx-background-radius: 12; -fx-border-radius: 12; -fx-border-color: #d1d5db; -fx-border-width: 1; -fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <FontIcon iconLiteral="bi-file-earmark-text" iconSize="20" iconColor="#DC3545"/>
                                <Label text="PDF Options"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #1a1a2e;"/>
                            </HBox>

                            <fx:define>
                                <ToggleGroup fx:id="pdfOrientationGroup"/>
                            </fx:define>

                            <Accordion fx:id="pdfSettingsAccordion">
                                <panes>
                                    <!-- Page Layout -->
                                    <TitledPane text="Page Layout" expanded="true">
                                        <content>
                                            <VBox spacing="10" style="-fx-padding: 10;">
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Page Size:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfPageSize" prefWidth="120" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Orientation:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <RadioButton fx:id="pdfOrientationPortrait" text="Portrait" selected="true" toggleGroup="$pdfOrientationGroup"/>
                                                    <RadioButton fx:id="pdfOrientationLandscape" text="Landscape" toggleGroup="$pdfOrientationGroup"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Margins:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfMargins" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <!-- Content Sections -->
                                    <TitledPane text="Content Sections" expanded="true">
                                        <content>
                                            <VBox spacing="8" style="-fx-padding: 10;">
                                                <CheckBox fx:id="pdfIncludeCoverPage" text="Include Cover Page" selected="true"/>
                                                <CheckBox fx:id="pdfIncludeToc" text="Include Table of Contents" selected="true"/>
                                                <CheckBox fx:id="pdfIncludeSchemaOverview" text="Include Schema Overview" selected="true"/>
                                                <CheckBox fx:id="pdfIncludeSchemaDiagram" text="Include Schema Diagram" selected="true"/>
                                                <CheckBox fx:id="pdfIncludeElementDiagrams" text="Include Element Diagrams" selected="false">
                                                    <tooltip>
                                                        <Tooltip text="Embed SVG diagrams for each element in the Data Dictionary"/>
                                                    </tooltip>
                                                </CheckBox>
                                                <CheckBox fx:id="pdfIncludeComplexTypes" text="Include ComplexTypes Section" selected="true"/>
                                                <CheckBox fx:id="pdfIncludeSimpleTypes" text="Include SimpleTypes Section" selected="true"/>
                                                <CheckBox fx:id="pdfIncludeDataDictionary" text="Include Data Dictionary" selected="true"/>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <!-- Typography -->
                                    <TitledPane text="Typography" expanded="false">
                                        <content>
                                            <VBox spacing="10" style="-fx-padding: 10;">
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Font Size:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfFontSize" prefWidth="100" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Font Family:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfFontFamily" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Heading Style:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfHeadingStyle" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Line Spacing:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfLineSpacing" prefWidth="120" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <!-- Header and Footer -->
                                    <TitledPane text="Header &amp; Footer" expanded="false">
                                        <content>
                                            <VBox spacing="10" style="-fx-padding: 10;">
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Header Style:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfHeaderStyle" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Footer Style:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfFooterStyle" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <CheckBox fx:id="pdfIncludePageNumbers" text="Include Page Numbers" selected="true"/>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Page # Position:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfPageNumberPosition" prefWidth="100" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <!-- Design and Colors -->
                                    <TitledPane text="Design &amp; Colors" expanded="false">
                                        <content>
                                            <VBox spacing="10" style="-fx-padding: 10;">
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Color Scheme:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfColorScheme" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Table Style:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfTableStyle" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Watermark:" prefWidth="120" style="-fx-font-size: 13px;"/>
                                                    <ChoiceBox fx:id="pdfWatermark" prefWidth="150" style="-fx-background-radius: 6;"/>
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </TitledPane>

                                    <!-- PDF Metadata -->
                                    <TitledPane text="PDF Metadata" expanded="false">
                                        <content>
                                            <VBox spacing="10" style="-fx-padding: 10;">
                                                <CheckBox fx:id="pdfBookmarks" text="Generate PDF Bookmarks" selected="true">
                                                    <tooltip>
                                                        <Tooltip text="Create navigation bookmarks in the PDF"/>
                                                    </tooltip>
                                                </CheckBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Title:" prefWidth="80" style="-fx-font-size: 13px;"/>
                                                    <TextField fx:id="pdfTitle" promptText="Auto (Schema-Name)" HBox.hgrow="ALWAYS"
                                                               style="-fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Author:" prefWidth="80" style="-fx-font-size: 13px;"/>
                                                    <TextField fx:id="pdfAuthor" promptText="Auto (System User)" HBox.hgrow="ALWAYS"
                                                               style="-fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Subject:" prefWidth="80" style="-fx-font-size: 13px;"/>
                                                    <TextField fx:id="pdfSubject" promptText="Optional" HBox.hgrow="ALWAYS"
                                                               style="-fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db;"/>
                                                </HBox>
                                                <HBox spacing="10" alignment="CENTER_LEFT">
                                                    <Label text="Keywords:" prefWidth="80" style="-fx-font-size: 13px;"/>
                                                    <TextField fx:id="pdfKeywords" promptText="Optional, comma-separated" HBox.hgrow="ALWAYS"
                                                               style="-fx-background-radius: 6; -fx-border-radius: 6; -fx-border-color: #d1d5db;"/>
                                                </HBox>
                                            </VBox>
                                        </content>
                                    </TitledPane>
                                </panes>
                            </Accordion>
                        </VBox>

                    </HBox>

                    <!-- Generate Button Row -->
                    <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-padding: 10 0 0 0;">
                        <Button fx:id="cancelDocumentationButton" onAction="#cancelDocumentationGeneration" text="Cancel" prefWidth="150" prefHeight="45"
                                visible="false" managed="false"
                                style="-fx-background-color: #dc3545; -fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold; -fx-background-radius: 8; -fx-cursor: hand;">
                            <graphic>
                                <FontIcon iconLiteral="bi-x-circle" iconSize="18" iconColor="white"/>
                            </graphic>
                        </Button>
                        <Button fx:id="generateDocumentationButton" onAction="#generateDocumentation" text="Generate" prefWidth="200" prefHeight="45"
                                style="-fx-background-color: #4a7fd9; -fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold; -fx-background-radius: 8; -fx-cursor: hand;">
                            <graphic>
                                <FontIcon iconLiteral="bi-play-fill" iconSize="18" iconColor="white"/>
                            </graphic>
                        </Button>
                    </HBox>

                    <!-- Progress Section -->
                    <ScrollPane fx:id="progressScrollPane" fitToWidth="true" visible="false" managed="false"
                                style="-fx-background-color: white; -fx-background-radius: 12;">
                        <VBox fx:id="progressContainer" spacing="5" style="-fx-padding: 15; -fx-background-color: white;"/>
                    </ScrollPane>

                    <!-- Status Message -->
                    <HBox fx:id="statusMessageContainer" alignment="CENTER_LEFT" visible="false" managed="false"
                          style="-fx-background-color: #d4edda; -fx-background-radius: 8; -fx-padding: 15; -fx-border-radius: 8; -fx-border-color: #c3e6cb; -fx-border-width: 1;">
                        <FontIcon iconLiteral="bi-check-circle-fill" iconSize="18" iconColor="#28a745"/>
                        <Label fx:id="statusText" style="-fx-text-fill: #155724; -fx-font-size: 14px; -fx-padding: 0 0 0 10;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="openDocFolder" onAction="#openGeneratedDocFolder" text="Open Folder"
                                style="-fx-background-color: transparent; -fx-text-fill: #155724; -fx-underline: true; -fx-cursor: hand;">
                            <graphic>
                                <FontIcon iconLiteral="bi-folder2-open" iconSize="14" iconColor="#155724"/>
                            </graphic>
                        </Button>
                    </HBox>

                </VBox>
            </ScrollPane>

        </Tab>
        <Tab fx:id="docPreviewTab" text="Preview">
            <content>
                <BorderPane>
                    <!-- Zoom controls at the top -->
                    <top>
                        <HBox spacing="5"
                              style="-fx-padding: 10px; -fx-background-color: #f0f0f0; -fx-alignment: CENTER_LEFT;">
                            <Button fx:id="zoomInButton" text="+" onAction="#handleZoomIn">
                                <graphic>
                                    <FontIcon iconLiteral="bi-zoom-in" iconSize="16"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Zoom In (Ctrl +)"/>
                                </tooltip>
                            </Button>
                            <Button fx:id="zoomOutButton" text="-" onAction="#handleZoomOut">
                                <graphic>
                                    <FontIcon iconLiteral="bi-zoom-out" iconSize="16"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Zoom Out (Ctrl -)"/>
                                </tooltip>
                            </Button>
                            <Button fx:id="zoomResetButton" text="100%" onAction="#handleZoomReset">
                                <graphic>
                                    <FontIcon iconLiteral="bi-aspect-ratio" iconSize="16"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Reset Zoom to 100% (Ctrl 0)"/>
                                </tooltip>
                            </Button>
                            <Label fx:id="zoomLabel" text="100%" style="-fx-padding: 5px; -fx-font-weight: bold;"/>
                        </HBox>
                    </top>
                    <!-- WebView in the center -->
                    <center>
                        <WebView fx:id="docWebView"/>
                    </center>
                </BorderPane>
            </content>
        </Tab>
        <Tab styleClass="output-tab" closable="false" text="Generate Example Data">
            <tooltip>
                <Tooltip text="Sample Data Generator - Create XML examples (Ctrl+6)"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-keyboard" iconSize="16"/>
            </graphic>
            <VBox spacing="15" style="-fx-padding: 20px; -fx-background-color: white;">
                <VBox spacing="10">
                    <Label styleClass="h3" text="Sample Data Generator"/>
                    <Label wrapText="true"
                           text="This tab allows you to generate sample XML data that conforms to the loaded XSD schema. You can specify whether to include only mandatory elements and set a limit for repeating elements."/>
                    <Separator style="-fx-padding: 5 0 5 0;"/>

                    <GridPane hgap="10" vgap="10">
                        <Label text="XSD Source File:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <HBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0" HBox.hgrow="ALWAYS">
                            <TextField fx:id="xsdForSampleDataPath" promptText="Load an XSD file..."
                                       HBox.hgrow="ALWAYS"/>
                            <Button onAction="#openXsdFileChooser" text="Load XSD">
                                <graphic>
                                    <FontIcon iconLiteral="bi-folder2-open"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <Label text="Output XML File (optional):" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        <HBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1" HBox.hgrow="ALWAYS">
                            <TextField fx:id="outputXmlPath" promptText="Select where to save the XML file..."
                                       HBox.hgrow="ALWAYS"/>
                            <Button onAction="#selectOutputXmlFile" text="Save to...">
                                <graphic>
                                    <FontIcon iconLiteral="bi-save"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <Label text="Settings:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                        <HBox spacing="20" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="2">
                            <CheckBox fx:id="mandatoryOnlyCheckBox" text="Create mandatory elements only"/>
                            <Label text="Max occurrences for repeating elements:"/>
                            <Spinner fx:id="maxOccurrencesSpinner" editable="true" prefWidth="70"/>
                        </HBox>

                        <columnConstraints>
                            <ColumnConstraints hgrow="NEVER" minWidth="180.0"/>
                            <ColumnConstraints hgrow="ALWAYS"/>
                        </columnConstraints>
                        <rowConstraints>
                            <RowConstraints/>
                            <RowConstraints/>
                            <RowConstraints/>
                        </rowConstraints>
                    </GridPane>
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Button fx:id="generateSampleDataButton" onAction="#generateSampleDataAction"
                                text="Generate Sample XML" disable="true">
                            <graphic>
                                <FontIcon iconLiteral="bi-play-fill" iconSize="16"/>
                            </graphic>
                        </Button>
                        <Button fx:id="validateGeneratedXmlButton" onAction="#validateGeneratedXmlAction"
                                text="Validate XML" disable="true">
                            <graphic>
                                <FontIcon iconLiteral="bi-check-circle" iconSize="16" iconColor="#28a745"/>
                            </graphic>
                            <tooltip>
                                <Tooltip text="Validate the generated XML against the XSD schema"/>
                            </tooltip>
                        </Button>
                    </HBox>
                </VBox>

                <!-- Validation Result Panel -->
                <VBox fx:id="sampleDataValidationResultPanel" spacing="8" visible="false" managed="false"
                      style="-fx-padding: 10; -fx-background-radius: 6; -fx-border-radius: 6;">
                    <!-- Header with summary -->
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <FontIcon fx:id="sampleDataValidationIcon" iconSize="18"/>
                        <VBox spacing="2" HBox.hgrow="ALWAYS">
                            <Label fx:id="sampleDataValidationTitle" style="-fx-font-weight: bold;"/>
                            <Label fx:id="sampleDataValidationMessage" wrapText="true" style="-fx-font-size: 12px;"/>
                        </VBox>
                        <HBox spacing="5" alignment="CENTER_RIGHT">
                            <Button fx:id="exportValidationErrorsButton" onAction="#exportValidationErrors"
                                    text="Export" style="-fx-font-size: 11px;">
                                <graphic>
                                    <FontIcon iconLiteral="bi-download" iconSize="12"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Export validation errors to file"/>
                                </tooltip>
                            </Button>
                            <Button onAction="#closeSampleDataValidationPanel"
                                    style="-fx-background-color: transparent; -fx-padding: 2;">
                                <graphic>
                                    <FontIcon iconLiteral="bi-x" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>
                    </HBox>
                    <!-- Error Table -->
                    <TableView fx:id="validationErrorsTable" prefHeight="150" maxHeight="200"
                               style="-fx-font-size: 11px;">
                        <columns>
                            <TableColumn fx:id="errorLineColumn" text="Line" prefWidth="50" minWidth="40"/>
                            <TableColumn fx:id="errorColumnColumn" text="Col" prefWidth="40" minWidth="35"/>
                            <TableColumn fx:id="errorSeverityColumn" text="Severity" prefWidth="70" minWidth="60"/>
                            <TableColumn fx:id="errorMessageColumn" text="Message" prefWidth="500" minWidth="200"/>
                        </columns>
                        <placeholder>
                            <Label text="No validation errors"/>
                        </placeholder>
                    </TableView>
                </VBox>

                <StackPane VBox.vgrow="ALWAYS">
                    <!-- RichTextFX: VirtualizedScrollPane fr Scrollbalken -->
                    <VirtualizedScrollPane>
                        <content>
                            <CodeArea fx:id="sampleDataTextArea" prefWidth="800" prefHeight="600"/>
                        </content>
                    </VirtualizedScrollPane>
                    <ProgressIndicator fx:id="progressSampleData" maxWidth="80" maxHeight="80" visible="false"/>
                </StackPane>
            </VBox>
        </Tab>
        <Tab fx:id="flattenTab" text="Flatten Schema" styleClass="utility-tab" closable="false">
            <tooltip>
                <Tooltip text="Schema Flattener - Merge includes into one file (Ctrl+7)"/>
            </tooltip>
            <graphic>
                <FontIcon iconLiteral="bi-layers-half" iconSize="16"/>
            </graphic>
            <VBox spacing="15" style="-fx-padding: 20px; -fx-background-color: white;">
                <VBox spacing="10">
                    <Label styleClass="h3" text="Schema Flattener"/>
                    <Label wrapText="true"
                           text="This tool merges an XSD file and all its included parts (via &lt;xs:include&gt;) into a single, self-contained XSD file. This is useful for distribution or for tools that do not support includes."/>
                    <Separator style="-fx-padding: 5 0 5 0;"/>

                    <GridPane hgap="10" vgap="10">
                        <Label text="Source XSD File:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <HBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0" HBox.hgrow="ALWAYS">
                            <TextField fx:id="xsdToFlattenPath" promptText="Load the main XSD file..."
                                       HBox.hgrow="ALWAYS"/>
                            <Button onAction="#openXsdToFlattenChooser" text="Load XSD">
                                <graphic>
                                    <FontIcon iconLiteral="bi-folder2-open"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <Label text="Save Flattened XSD to:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        <HBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1" HBox.hgrow="ALWAYS">
                            <TextField fx:id="flattenedXsdPath" promptText="Select where to save the flattened file..."
                                       HBox.hgrow="ALWAYS"/>
                            <Button onAction="#selectFlattenedXsdPath" text="Save to...">
                                <graphic>
                                    <FontIcon iconLiteral="bi-save"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <Label text="Flattening Options:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                        <VBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="2">
                            <HBox spacing="20" alignment="CENTER_LEFT">
                                <CheckBox fx:id="flattenIncludesCheckBox" selected="true" text="Flatten xs:include">
                                    <tooltip>
                                        <Tooltip text="Inline content from xs:include directives (same namespace)"/>
                                    </tooltip>
                                </CheckBox>
                                <CheckBox fx:id="flattenImportsCheckBox" selected="false" text="Flatten xs:import">
                                    <tooltip>
                                        <Tooltip text="Inline content from xs:import directives (different namespace)"/>
                                    </tooltip>
                                </CheckBox>
                            </HBox>
                            <HBox spacing="20" alignment="CENTER_LEFT">
                                <CheckBox fx:id="removeCommentsCheckBox" selected="false" text="Remove comments">
                                    <tooltip>
                                        <Tooltip text="Remove all XML comments from the flattened output"/>
                                    </tooltip>
                                </CheckBox>
                                <CheckBox fx:id="addSourceFileAsAppinfoCheckBox" selected="false" text="Track source files (xs:appinfo)">
                                    <tooltip>
                                        <Tooltip text="Add xs:appinfo with source filename for elements from included files"/>
                                    </tooltip>
                                </CheckBox>
                            </HBox>
                        </VBox>

                        <Label text="Sort Order:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                        <HBox spacing="20" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="3">
                            <fx:define>
                                <ToggleGroup fx:id="flattenSortOrderGroup"/>
                            </fx:define>
                            <RadioButton fx:id="flattenSortTypeBeforeName" text="Type before Name"
                                         toggleGroup="$flattenSortOrderGroup">
                                <tooltip>
                                    <Tooltip
                                            text="Sort by XSD construct type first (attributeGroup, complexType, etc.), then by name"/>
                                </tooltip>
                            </RadioButton>
                            <RadioButton fx:id="flattenSortNameBeforeType" text="Name before Type"
                                         toggleGroup="$flattenSortOrderGroup">
                                <tooltip>
                                    <Tooltip text="Sort elements purely by name (alphabetically)"/>
                                </tooltip>
                            </RadioButton>
                        </HBox>

                        <columnConstraints>
                            <ColumnConstraints hgrow="NEVER" minWidth="180.0"/>
                            <ColumnConstraints hgrow="ALWAYS"/>
                        </columnConstraints>
                        <rowConstraints>
                            <RowConstraints/>
                            <RowConstraints/>
                            <RowConstraints/>
                            <RowConstraints/>
                        </rowConstraints>
                    </GridPane>
                    <Button fx:id="flattenXsdButton" onAction="#flattenXsdAction"
                            text="Flatten XSD" disable="true">
                        <graphic>
                            <FontIcon iconLiteral="bi-play-fill" iconSize="16"/>
                        </graphic>
                    </Button>
                    <Label fx:id="flattenStatusLabel" style="-fx-padding: 5 0;"/>
                </VBox>

                <StackPane VBox.vgrow="ALWAYS">
                    <!-- RichTextFX: VirtualizedScrollPane fr Scrollbalken -->
                    <VirtualizedScrollPane>
                        <content>
                            <CodeArea fx:id="flattenedXsdTextArea" editable="false" prefWidth="800" prefHeight="600"/>
                        </content>
                    </VirtualizedScrollPane>
                    <ProgressIndicator fx:id="flattenProgress" maxWidth="80" maxHeight="80" visible="false"/>
                </StackPane>
            </VBox>
        </Tab>
    </TabPane>

    <!-- Task/Status Bar -->
    <VBox fx:id="taskStatusBar" managed="false" spacing="5.0"
          style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-border-color: #dee2e6; -fx-border-width: 1 0 0 0;" visible="false">
        <children>
            <HBox alignment="CENTER_LEFT" spacing="10.0">
                <children>
                    <ProgressIndicator fx:id="taskProgressIndicator" maxHeight="24" maxWidth="24" visible="false"/>
                    <Label style="-fx-font-weight: bold;" text="Background Task" />
                    <Label fx:id="taskTimerLabel" style="-fx-font-family: 'Consolas', 'Monaco', monospace; -fx-font-size: 14px; -fx-text-fill: #4a7fd9; -fx-font-weight: bold;"/>
                    <Region HBox.hgrow="ALWAYS" />
                </children>
            </HBox>
            <VBox fx:id="taskContainer" spacing="5.0"/>
        </children>
    </VBox>
</VBox>
<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ FreeXMLToolkit - Universal Toolkit for XML
  ~ Copyright (c) Karl Kauc 2024.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  ~
  -->

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.*?>
<VBox prefHeight="768.0" prefWidth="1024.0" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0"
      AnchorPane.rightAnchor="0" AnchorPane.topAnchor="0" xmlns="http://javafx.com/javafx/11.0.14-internal"
      xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.fxt.freexmltoolkit.controller.SchemaGeneratorController"
      stylesheets="@../css/xsd-tab-groups.css">

    <!-- Schema Generator Operations Toolbar -->
    <ToolBar styleClass="xsd-toolbar">
        <!-- File Operations Group -->
        <Button fx:id="loadXmlBtn" text="Open XML" contentDisplay="TOP" styleClass="toolbar-button"
                onAction="#loadXml">
            <graphic>
                <FontIcon iconLiteral="bi-file-earmark-code" iconSize="20" iconColor="#007bff" styleClass="toolbar-icon-primary"/>
            </graphic>
            <tooltip>
                <Tooltip text="Open XML File"/>
            </tooltip>
        </Button>

        <Separator orientation="VERTICAL"/>

        <!-- Primary Action Group -->
        <Button fx:id="generateSchemaBtn" text="Generate" contentDisplay="TOP" styleClass="toolbar-button"
                onAction="#generateSchema">
            <graphic>
                <FontIcon iconLiteral="bi-play-circle-fill" iconSize="20" iconColor="#28a745" styleClass="toolbar-icon-success"/>
            </graphic>
            <tooltip>
                <Tooltip text="Generate XSD Schema (F5)"/>
            </tooltip>
        </Button>

        <Separator orientation="VERTICAL"/>

        <!-- Favorites Group -->
        <Button fx:id="addToFavoritesBtn" text="Add Favorite" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-star" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Add to Favorites (Ctrl+D)"/>
            </tooltip>
        </Button>

        <Button fx:id="toggleFavoritesButton" text="Favorites" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-star-fill" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Show/Hide Favorites (Ctrl+Shift+D)"/>
            </tooltip>
        </Button>

        <Region HBox.hgrow="ALWAYS"/>

        <!-- Help -->
        <Button fx:id="helpBtn" text="Help" contentDisplay="TOP" styleClass="toolbar-button" onAction="#showHelp">
            <graphic>
                <FontIcon iconLiteral="bi-question-circle" iconSize="20" iconColor="#17a2b8" styleClass="toolbar-icon-info"/>
            </graphic>
            <tooltip>
                <Tooltip text="Help (F1)"/>
            </tooltip>
        </Button>
    </ToolBar>

    <!-- Main Content Area -->
    <SplitPane VBox.vgrow="ALWAYS" dividerPositions="0.75">
        <!-- Left Panel: Configuration and XML Input wrapped in StackPane for Empty State -->
        <StackPane>
            <!-- Empty State -->
            <VBox fx:id="emptyStatePane" spacing="20" alignment="CENTER" styleClass="empty-state"
                  visible="true" managed="true">
                <FontIcon iconLiteral="bi-diagram-3" iconSize="64" iconColor="#adb5bd"/>
                <Label text="Ready to Generate Schema" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #495057;"/>
                <Label text="Load an XML file or paste XML content to generate an XSD schema" wrapText="true" textAlignment="CENTER"
                       style="-fx-font-size: 14px; -fx-text-fill: #6c757d;" maxWidth="400"/>
                <HBox spacing="10" alignment="CENTER">
                    <Button fx:id="emptyStateOpenXmlButton" text="Open XML File" styleClass="btn-primary">
                        <graphic>
                            <FontIcon iconLiteral="bi-file-earmark-code" iconSize="16" iconColor="white"/>
                        </graphic>
                    </Button>
                    <Button fx:id="emptyStatePasteButton" text="Paste XML" styleClass="btn-secondary">
                        <graphic>
                            <FontIcon iconLiteral="bi-clipboard" iconSize="16"/>
                        </graphic>
                    </Button>
                </HBox>
            </VBox>

            <!-- Main Content (initially hidden) -->
            <VBox fx:id="contentPane" spacing="15" styleClass="schema-config-sidebar" visible="false" managed="false">
            <padding>
                <Insets top="15" bottom="15" left="15" right="15"/>
            </padding>

            <!-- Generation Options -->
            <VBox spacing="10" styleClass="config-panel">
                <Label text="Schema Generation Options" styleClass="section-header"/>

                <!-- Type Inference Options -->
                <VBox spacing="8">
                    <Label text="Type Inference" styleClass="subsection-header"/>
                    <CheckBox fx:id="enableSmartTypeInference" text="Smart Type Inference" selected="true"/>
                    <CheckBox fx:id="inferComplexTypes" text="Infer Complex Types" selected="true"/>
                    <CheckBox fx:id="strictTypeInference" text="Strict Type Inference"/>
                    <CheckBox fx:id="analyzeDataPatterns" text="Analyze Data Patterns" selected="true"/>
                </VBox>

                <!-- Structure Options -->
                <VBox spacing="8">
                    <Label text="Schema Structure" styleClass="subsection-header"/>
                    <CheckBox fx:id="generateComplexTypes" text="Generate Complex Types" selected="true"/>
                    <CheckBox fx:id="inlineSimpleTypes" text="Inline Simple Types"/>
                    <CheckBox fx:id="groupSimilarElements" text="Group Similar Elements" selected="true"/>
                    <CheckBox fx:id="generateGroups" text="Generate Groups"/>
                </VBox>

                <!-- Optimization Options -->
                <VBox spacing="8">
                    <Label text="Schema Optimization" styleClass="subsection-header"/>
                    <CheckBox fx:id="optimizeSchema" text="Optimize Schema" selected="true"/>
                    <CheckBox fx:id="eliminateDuplicates" text="Eliminate Duplicates" selected="true"/>
                    <CheckBox fx:id="mergeCompatibleTypes" text="Merge Compatible Types" selected="true"/>
                </VBox>

                <!-- Namespace Handling -->
                <VBox spacing="8">
                    <Label text="Namespace Handling" styleClass="subsection-header"/>
                    <CheckBox fx:id="preserveNamespaces" text="Preserve Namespaces" selected="true"/>
                    <CheckBox fx:id="generateTargetNamespace" text="Generate Target Namespace" selected="true"/>
                    <TextField fx:id="targetNamespaceField" promptText="Target namespace URI..."
                              />
                </VBox>
            </VBox>

            <!-- XML Input -->
            <VBox spacing="10" styleClass="xml-input-panel" VBox.vgrow="ALWAYS">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="XML Input" styleClass="section-header"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Button fx:id="pasteXmlBtn" text="Paste" styleClass="btn-outline" onAction="#pasteXml">
                        <graphic>
                            <FontIcon iconLiteral="bi-clipboard" iconSize="14"/>
                        </graphic>
                    </Button>
                    <Button fx:id="clearXmlBtn" text="Clear" styleClass="btn-outline" onAction="#clearXml">
                        <graphic>
                            <FontIcon iconLiteral="bi-trash" iconSize="14"/>
                        </graphic>
                    </Button>
                </HBox>

                <TextArea fx:id="xmlInputArea" VBox.vgrow="ALWAYS" styleClass="code-input"
                          promptText="Paste your XML content here or use 'Load XML' to open a file..."/>
            </VBox>

            <!-- Progress Indicator -->
            <ProgressBar fx:id="generationProgressBar" prefWidth="Infinity" visible="false"/>
            </VBox>
        </StackPane>

        <!-- Right Panel: Generated Schema and Analysis + Favorites -->
        <SplitPane fx:id="rightSplitPane" orientation="HORIZONTAL" dividerPositions="0.75">
            <!-- Generated Schema and Analysis Section -->
            <VBox spacing="10" styleClass="schema-results">
                <padding>
                    <Insets top="15" bottom="15" left="15" right="15"/>
                </padding>

            <!-- Results Header -->
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label text="Generated XSD Schema" styleClass="section-header"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="generationStatsLabel" text="" styleClass="generation-stats"/>
                <Button fx:id="exportSchemaBtn" text="Export XSD" styleClass="btn-primary" onAction="#exportSchema"
                        disable="true">
                    <graphic>
                        <FontIcon iconLiteral="bi-download" iconSize="16"/>
                    </graphic>
                </Button>
            </HBox>

            <!-- Schema Results Tabs -->
            <TabPane fx:id="schemaResultsTabPane" VBox.vgrow="ALWAYS">
                <!-- Generated XSD Tab -->
                <Tab text="Generated XSD" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-file-earmark-code" iconSize="16" iconColor="#007bff"/>
                    </graphic>
                    <VBox spacing="5">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <CheckBox fx:id="formatXsdOutput" text="Format Output" selected="true"/>
                            <CheckBox fx:id="addComments" text="Add Comments" selected="true"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="copyXsdBtn" text="Copy" styleClass="btn-outline" onAction="#copyXsd">
                                <graphic>
                                    <FontIcon iconLiteral="bi-clipboard" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>
                        <TextArea fx:id="xsdOutputArea" VBox.vgrow="ALWAYS" styleClass="code-preview"
                                  editable="false" wrapText="false"/>
                    </VBox>
                </Tab>

                <!-- Analysis Results Tab -->
                <Tab text="Analysis Results" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-graph-up" iconSize="16" iconColor="#28a745"/>
                    </graphic>
                    <VBox spacing="10">
                        <HBox spacing="20">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Schema Statistics" styleClass="subsection-header"/>
                                <GridPane hgap="10" vgap="5" styleClass="stats-grid">
                                    <Label text="Complex Types:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="complexTypesLabel" text="0" GridPane.columnIndex="1"
                                           GridPane.rowIndex="0"/>
                                    <Label text="Simple Types:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="simpleTypesLabel" text="0" GridPane.columnIndex="1"
                                           GridPane.rowIndex="1"/>
                                    <Label text="Elements:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <Label fx:id="elementsLabel" text="0" GridPane.columnIndex="1"
                                           GridPane.rowIndex="2"/>
                                    <Label text="Attributes:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                    <Label fx:id="attributesLabel" text="0" GridPane.columnIndex="1"
                                           GridPane.rowIndex="3"/>
                                    <Label text="Namespaces:" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                                    <Label fx:id="namespacesLabel" text="0" GridPane.columnIndex="1"
                                           GridPane.rowIndex="4"/>
                                </GridPane>
                            </VBox>

                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Performance Metrics" styleClass="subsection-header"/>
                                <GridPane hgap="10" vgap="5" styleClass="stats-grid">
                                    <Label text="Generation Time:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="generationTimeLabel" text="0ms" GridPane.columnIndex="1"
                                           GridPane.rowIndex="0"/>
                                    <Label text="XML Size:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="xmlSizeLabel" text="0KB" GridPane.columnIndex="1"
                                           GridPane.rowIndex="1"/>
                                    <Label text="XSD Size:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <Label fx:id="xsdSizeLabel" text="0KB" GridPane.columnIndex="1"
                                           GridPane.rowIndex="2"/>
                                    <Label text="Compression:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                    <Label fx:id="compressionLabel" text="0%" GridPane.columnIndex="1"
                                           GridPane.rowIndex="3"/>
                                </GridPane>
                            </VBox>
                        </HBox>

                        <!-- Detailed Analysis -->
                        <VBox spacing="5" VBox.vgrow="ALWAYS">
                            <Label text="Detailed Analysis Report" styleClass="subsection-header"/>
                            <TextArea fx:id="analysisReportArea" VBox.vgrow="ALWAYS" styleClass="code-preview"
                                      editable="false" wrapText="true"/>
                        </VBox>
                    </VBox>
                </Tab>

                <!-- Type Definitions Tab -->
                <Tab text="Type Definitions" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-list-ul" iconSize="16" iconColor="#6c757d"/>
                    </graphic>
                    <VBox spacing="10">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <ComboBox fx:id="typeFilterCombo" promptText="Filter by type..."
                                     />
                            <TextField fx:id="typeSearchField" promptText="Search types..."
                                      />
                        </HBox>

                        <TableView fx:id="typeDefinitionsTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="typeNameColumn" text="Type Name" prefWidth="150"/>
                                <TableColumn fx:id="typeKindColumn" text="Kind" prefWidth="80"/>
                                <TableColumn fx:id="typeBaseColumn" text="Base Type" prefWidth="120"/>
                                <TableColumn fx:id="typeUsageColumn" text="Usage Count" prefWidth="80"/>
                                <TableColumn fx:id="typeDescriptionColumn" text="Description" prefWidth="200"/>
                            </columns>
                        </TableView>
                    </VBox>
                </Tab>
            </TabPane>
            </VBox>

            <!-- Favorites Panel (unified component) -->
            <fx:include fx:id="favoritesPanel" source="controls/FavoritesPanel.fxml"/>
        </SplitPane>
    </SplitPane>
</VBox>
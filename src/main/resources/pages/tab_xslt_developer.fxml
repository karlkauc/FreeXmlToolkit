<?xml version="1.0" encoding="UTF-8"?>

<!--
  ~ FreeXMLToolkit - Universal Toolkit for XML
  ~ Copyright (c) Karl Kauc 2024.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  ~
  -->

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>
<?import org.kordamp.ikonli.javafx.*?>
<VBox prefHeight="768.0" prefWidth="1024.0" AnchorPane.bottomAnchor="0" AnchorPane.leftAnchor="0"
      AnchorPane.rightAnchor="0" AnchorPane.topAnchor="0" xmlns="http://javafx.com/javafx/11.0.14-internal"
      xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.fxt.freexmltoolkit.controller.XsltDeveloperController"
      stylesheets="@../css/xsd-tab-groups.css">

    <!-- XSLT Developer Operations Toolbar -->
    <ToolBar styleClass="xsd-toolbar">
        <!-- File Operations Group -->
        <Button fx:id="loadXmlBtn" text="Open XML" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-file-earmark-code" iconSize="20" iconColor="#007bff" styleClass="toolbar-icon-primary"/>
            </graphic>
            <tooltip>
                <Tooltip text="Open XML File"/>
            </tooltip>
        </Button>

        <Button fx:id="loadXsltBtn" text="Open XSLT" contentDisplay="TOP" styleClass="toolbar-button" onAction="#loadXsltFile">
            <graphic>
                <FontIcon iconLiteral="bi-file-earmark-code" iconSize="20" iconColor="#6f42c1" styleClass="toolbar-icon-primary"/>
            </graphic>
            <tooltip>
                <Tooltip text="Open XSLT Stylesheet"/>
            </tooltip>
        </Button>

        <MenuButton fx:id="recentFilesMenuBtn" text="Recent" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-clock-history" iconSize="20" iconColor="#6c757d" styleClass="toolbar-icon"/>
            </graphic>
            <tooltip>
                <Tooltip text="Recently Opened XSLT Files"/>
            </tooltip>
        </MenuButton>

        <Separator orientation="VERTICAL"/>

        <!-- Transform Action -->
        <Button fx:id="transformBtn" text="Transform" contentDisplay="TOP" styleClass="toolbar-button" onAction="#executeTransformation">
            <graphic>
                <FontIcon iconLiteral="bi-play-fill" iconSize="20" iconColor="#28a745" styleClass="toolbar-icon-success"/>
            </graphic>
            <tooltip>
                <Tooltip text="Execute Transformation (F5 or Ctrl+R)"/>
            </tooltip>
        </Button>

        <ToggleButton fx:id="liveTransformToggle" text="Live" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-lightning" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Toggle Live Transform (Ctrl+L)"/>
            </tooltip>
        </ToggleButton>

        <Separator orientation="VERTICAL"/>

        <!-- Favorites Group -->
        <Button fx:id="addToFavoritesBtn" text="Add Favorite" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-star" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Add to Favorites (Ctrl+D)"/>
            </tooltip>
        </Button>

        <Button fx:id="toggleFavoritesButton" text="Favorites" contentDisplay="TOP" styleClass="toolbar-button">
            <graphic>
                <FontIcon iconLiteral="bi-star-fill" iconSize="20" iconColor="#ffc107" styleClass="toolbar-icon-warning"/>
            </graphic>
            <tooltip>
                <Tooltip text="Show/Hide Favorites (Ctrl+Shift+D)"/>
            </tooltip>
        </Button>

        <Region HBox.hgrow="ALWAYS"/>

        <!-- Help -->
        <Button fx:id="helpBtn" text="Help" contentDisplay="TOP" styleClass="toolbar-button" onAction="#showHelp">
            <graphic>
                <FontIcon iconLiteral="bi-question-circle" iconSize="20" iconColor="#17a2b8" styleClass="toolbar-icon-info"/>
            </graphic>
            <tooltip>
                <Tooltip text="Help (F1)"/>
            </tooltip>
        </Button>
    </ToolBar>

    <!-- Main Content Area wrapped in StackPane for Empty State -->
    <StackPane VBox.vgrow="ALWAYS">
        <!-- Empty State -->
        <VBox fx:id="emptyStatePane" spacing="20" alignment="CENTER" styleClass="empty-state"
              visible="true" managed="true">
            <FontIcon iconLiteral="bi-arrow-repeat" iconSize="64" iconColor="#adb5bd"/>
            <Label text="Ready to Transform XML" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #495057;"/>
            <Label text="Load XML and XSLT/XQuery files to transform your documents" wrapText="true" textAlignment="CENTER"
                   style="-fx-font-size: 14px; -fx-text-fill: #6c757d;" maxWidth="400"/>
            <HBox spacing="10" alignment="CENTER">
                <Button fx:id="emptyStateLoadXmlButton" text="Open XML File" styleClass="btn-primary">
                    <graphic>
                        <FontIcon iconLiteral="bi-file-earmark-code" iconSize="16" iconColor="white"/>
                    </graphic>
                </Button>
                <Button fx:id="emptyStateLoadXsltButton" text="Open XSLT File" styleClass="btn-secondary">
                    <graphic>
                        <FontIcon iconLiteral="bi-file-earmark-text" iconSize="16"/>
                    </graphic>
                </Button>
                <Button fx:id="emptyStateLoadXQueryButton" text="Open XQuery File" styleClass="btn-secondary">
                    <graphic>
                        <FontIcon iconLiteral="bi-braces" iconSize="16"/>
                    </graphic>
                </Button>
            </HBox>
        </VBox>

        <!-- Main Content (initially hidden) -->
        <SplitPane fx:id="contentPane" dividerPositions="0.75" orientation="HORIZONTAL"
                   visible="false" managed="false">
        <!-- Left Panel: Input Section -->
        <VBox spacing="10" styleClass="xslt-input-section">
            <padding>
                <Insets top="10" bottom="10" left="15" right="15"/>
            </padding>

            <!-- Input Tabs -->
            <TabPane fx:id="inputTabPane" VBox.vgrow="ALWAYS">
                <!-- XML Input Tab -->
                <Tab text="XML Source" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-file-earmark-code" iconSize="16" iconColor="#007bff"/>
                    </graphic>
                    <VBox spacing="8">
                        <!-- Mode Toggle: Single File vs Multi-File -->
                        <HBox alignment="CENTER_LEFT" spacing="15" styleClass="mode-toggle-bar">
                            <fx:define>
                                <ToggleGroup fx:id="xmlInputModeGroup"/>
                            </fx:define>
                            <RadioButton fx:id="singleFileMode" text="Single File" toggleGroup="$xmlInputModeGroup"
                                         selected="true" onAction="#switchXmlInputMode">
                                <graphic>
                                    <FontIcon iconLiteral="bi-file-earmark" iconSize="14"/>
                                </graphic>
                            </RadioButton>
                            <RadioButton fx:id="multiFileMode" text="Multiple Files (Batch)" toggleGroup="$xmlInputModeGroup"
                                         onAction="#switchXmlInputMode">
                                <graphic>
                                    <FontIcon iconLiteral="bi-files" iconSize="14"/>
                                </graphic>
                            </RadioButton>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="xmlModeStatusLabel" text="" styleClass="mode-status"/>
                        </HBox>

                        <!-- StackPane to switch between single and multi-file modes -->
                        <StackPane VBox.vgrow="ALWAYS">
                            <!-- Single File Mode (existing functionality) -->
                            <VBox fx:id="singleFilePane" spacing="8" visible="true" managed="true">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label text="XML Input Document" styleClass="section-header"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button fx:id="innerLoadXmlBtn" text="Open" styleClass="btn-outline" onAction="#loadXmlFile">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-folder2-open" iconSize="14"/>
                                        </graphic>
                                    </Button>
                                    <Button fx:id="innerValidateXmlBtn" text="Validate" styleClass="btn-warning"
                                            onAction="#validateXml">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-check-circle" iconSize="14"/>
                                        </graphic>
                                    </Button>
                                </HBox>

                                <StackPane fx:id="xmlInputEditorPane" VBox.vgrow="ALWAYS" minHeight="200"/>
                            </VBox>

                            <!-- Multi-File Mode (new batch functionality) -->
                            <VBox fx:id="multiFilePane" spacing="8" visible="false" managed="false">
                                <HBox alignment="CENTER_LEFT" spacing="8">
                                    <Button fx:id="addXmlFilesBtn" text="Add Files" styleClass="btn-outline" onAction="#addXmlFiles">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-file-earmark-plus" iconSize="14" iconColor="#28a745"/>
                                        </graphic>
                                        <tooltip>
                                            <Tooltip text="Select multiple XML files"/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="addXmlDirectoryBtn" text="Add Directory" styleClass="btn-outline" onAction="#addXmlDirectory">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-folder-plus" iconSize="14" iconColor="#007bff"/>
                                        </graphic>
                                        <tooltip>
                                            <Tooltip text="Add all XML files from a directory"/>
                                        </tooltip>
                                    </Button>
                                    <Separator orientation="VERTICAL"/>
                                    <Button fx:id="removeSelectedFilesBtn" text="Remove" styleClass="btn-outline" onAction="#removeSelectedFiles">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-trash" iconSize="14" iconColor="#dc3545"/>
                                        </graphic>
                                        <tooltip>
                                            <Tooltip text="Remove selected files"/>
                                        </tooltip>
                                    </Button>
                                    <Button fx:id="clearAllFilesBtn" text="Clear All" styleClass="btn-outline" onAction="#clearAllFiles">
                                        <graphic>
                                            <FontIcon iconLiteral="bi-x-circle" iconSize="14" iconColor="#6c757d"/>
                                        </graphic>
                                    </Button>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <CheckBox fx:id="selectAllFilesCheckbox" text="Select All" selected="true" onAction="#toggleSelectAllFiles"/>
                                    <Label fx:id="fileCountLabel" text="0 files" styleClass="file-count-label"/>
                                </HBox>

                                <!-- File List TableView -->
                                <TableView fx:id="xmlFilesTable" VBox.vgrow="ALWAYS"
                                           styleClass="xml-files-table">
                                    <columns>
                                        <TableColumn fx:id="selectColumn" text="" prefWidth="30" maxWidth="40" minWidth="30"/>
                                        <TableColumn fx:id="fileNameColumn" text="File Name" prefWidth="250" minWidth="150"/>
                                        <TableColumn fx:id="fileSizeColumn" text="Size" prefWidth="80" minWidth="60"/>
                                        <TableColumn fx:id="fileStatusColumn" text="Status" prefWidth="100" minWidth="80"/>
                                    </columns>
                                    <placeholder>
                                        <VBox spacing="10" alignment="CENTER">
                                            <FontIcon iconLiteral="bi-files" iconSize="48" iconColor="#adb5bd"/>
                                            <Label text="No XML files added" style="-fx-text-fill: #6c757d;"/>
                                            <Label text="Use 'Add Files' or 'Add Directory' to select files for batch processing"
                                                   style="-fx-text-fill: #adb5bd; -fx-font-size: 11px;" wrapText="true" textAlignment="CENTER"/>
                                        </VBox>
                                    </placeholder>
                                </TableView>
                            </VBox>
                        </StackPane>
                    </VBox>
                </Tab>

                <!-- XSLT Stylesheet Tab -->
                <Tab fx:id="xsltStylesheetTab" text="XSLT Stylesheet" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-file-earmark-text" iconSize="16" iconColor="#fd7e14"/>
                    </graphic>
                    <VBox spacing="8">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="XSLT Stylesheet" styleClass="section-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="innerLoadXsltBtn" text="Open" styleClass="btn-outline" onAction="#loadXsltFile">
                                <graphic>
                                    <FontIcon iconLiteral="bi-folder2-open" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button fx:id="innerSaveXsltBtn" text="Save" styleClass="btn-outline" onAction="#saveXsltFile">
                                <graphic>
                                    <FontIcon iconLiteral="bi-save" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button fx:id="innerValidateXsltBtn" text="Validate" styleClass="btn-warning"
                                    onAction="#validateXslt">
                                <graphic>
                                    <FontIcon iconLiteral="bi-check-circle" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <StackPane fx:id="xsltInputEditorPane" VBox.vgrow="ALWAYS" minHeight="200"/>
                    </VBox>
                </Tab>

                <!-- XQuery Script Tab -->
                <Tab fx:id="xqueryScriptTab" text="XQuery Script" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-braces" iconSize="16" iconColor="#6f42c1"/>
                    </graphic>
                    <VBox spacing="8">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="XQuery Script" styleClass="section-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="innerLoadXQueryBtn" text="Open" styleClass="btn-outline" onAction="#loadXQueryFile">
                                <graphic>
                                    <FontIcon iconLiteral="bi-folder2-open" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button fx:id="innerSaveXQueryBtn" text="Save" styleClass="btn-outline" onAction="#saveXQueryFile">
                                <graphic>
                                    <FontIcon iconLiteral="bi-save" iconSize="14"/>
                                </graphic>
                            </Button>
                            <Button fx:id="innerValidateXQueryBtn" text="Validate" styleClass="btn-warning"
                                    onAction="#validateXQuery">
                                <graphic>
                                    <FontIcon iconLiteral="bi-check-circle" iconSize="14"/>
                                </graphic>
                            </Button>
                            <MenuButton fx:id="xqueryExamplesMenu" text="Examples" styleClass="btn-outline">
                                <graphic>
                                    <FontIcon iconLiteral="bi-collection" iconSize="14"/>
                                </graphic>
                                <items>
                                    <MenuItem text="Simple Query" onAction="#insertXQueryExampleSimple">
                                        <graphic><FontIcon iconLiteral="bi-code" iconSize="14" iconColor="#007bff"/></graphic>
                                    </MenuItem>
                                    <MenuItem text="FLWOR Expression" onAction="#insertXQueryExampleFlwor">
                                        <graphic><FontIcon iconLiteral="bi-braces" iconSize="14" iconColor="#6f42c1"/></graphic>
                                    </MenuItem>
                                    <MenuItem text="HTML Report" onAction="#insertXQueryExampleHtmlReport">
                                        <graphic><FontIcon iconLiteral="bi-file-earmark-code" iconSize="14" iconColor="#e44d26"/></graphic>
                                    </MenuItem>
                                    <SeparatorMenuItem/>
                                    <MenuItem text="Data Quality Check" onAction="#insertXQueryExampleDqCheck">
                                        <graphic><FontIcon iconLiteral="bi-check2-square" iconSize="14" iconColor="#28a745"/></graphic>
                                    </MenuItem>
                                </items>
                            </MenuButton>
                        </HBox>

                        <StackPane fx:id="xqueryInputEditorPane" VBox.vgrow="ALWAYS" minHeight="200"/>
                    </VBox>
                </Tab>

                <!-- Parameters Tab -->
                <Tab text="Parameters" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-gear" iconSize="16" iconColor="#6c757d"/>
                    </graphic>
                    <VBox spacing="10">
                        <padding>
                            <Insets top="10" bottom="10" left="10" right="10"/>
                        </padding>
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="XSLT Parameters" styleClass="section-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="addParameterBtn" text="Add" styleClass="btn-primary"
                                    onAction="#addParameter">
                                <graphic>
                                    <FontIcon iconLiteral="bi-plus-circle" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <!-- Header Row -->
                        <HBox spacing="10" styleClass="parameter-header">
                            <Label text="Name" minWidth="150" prefWidth="150" style="-fx-font-weight: bold;"/>
                            <Label text="Value" minWidth="200" style="-fx-font-weight: bold;" HBox.hgrow="ALWAYS"/>
                            <Label text="Type" minWidth="180" prefWidth="180" style="-fx-font-weight: bold;"/>
                            <Label text="" minWidth="32" prefWidth="32"/>
                        </HBox>

                        <!-- Scrollable Parameter Rows -->
                        <ScrollPane fx:id="parametersScrollPane" fitToWidth="true" VBox.vgrow="ALWAYS"
                                    style="-fx-background-color: transparent;">
                            <VBox fx:id="parametersContainer" spacing="5"/>
                        </ScrollPane>
                    </VBox>
                </Tab>
            </TabPane>
        </VBox>

        <!-- Right Panel: Output and Results + Favorites -->
        <SplitPane fx:id="rightSplitPane" orientation="HORIZONTAL" dividerPositions="0.75">
            <!-- Output and Results Section -->
            <VBox spacing="10" styleClass="xslt-output-section">
                <padding>
                    <Insets top="10" bottom="10" left="15" right="15"/>
                </padding>

            <!-- Output Configuration -->
            <HBox alignment="CENTER_LEFT" spacing="15" styleClass="output-config">
                <Label text="Output Format:" styleClass="section-label"/>
                <ComboBox fx:id="outputFormatCombo" prefWidth="100"/>

                <Label text="Encoding:" styleClass="section-label"/>
                <ComboBox fx:id="encodingCombo" prefWidth="100"/>

                <CheckBox fx:id="indentOutputCheckbox" text="Indent Output" selected="true"/>
            </HBox>

            <!-- Results Tabs -->
            <TabPane fx:id="resultsTabPane" VBox.vgrow="ALWAYS">
                <!-- Transformation Result Tab -->
                <Tab text="Result" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-check-circle" iconSize="16" iconColor="#28a745"/>
                    </graphic>
                    <VBox spacing="8">
                        <!-- Batch Result Controls (visible only in multi-file mode) -->
                        <HBox fx:id="batchResultControls" alignment="CENTER_LEFT" spacing="15"
                              visible="false" managed="false" styleClass="batch-result-controls">
                            <fx:define>
                                <ToggleGroup fx:id="resultViewModeGroup"/>
                            </fx:define>
                            <RadioButton fx:id="combinedResultMode" text="Combined" toggleGroup="$resultViewModeGroup"
                                         selected="true" onAction="#switchResultViewMode">
                                <graphic>
                                    <FontIcon iconLiteral="bi-collection" iconSize="14"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Show combined output from all files"/>
                                </tooltip>
                            </RadioButton>
                            <RadioButton fx:id="perFileResultMode" text="Per File" toggleGroup="$resultViewModeGroup"
                                         onAction="#switchResultViewMode">
                                <graphic>
                                    <FontIcon iconLiteral="bi-file-earmark-text" iconSize="14"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Show results for each file individually"/>
                                </tooltip>
                            </RadioButton>
                            <Separator orientation="VERTICAL"/>
                            <Label text="File:" styleClass="section-label"/>
                            <ComboBox fx:id="fileResultSelector" prefWidth="200" promptText="Select file..."
                                      onAction="#onFileResultSelected" disable="true"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="batchStatsLabel" text="" styleClass="batch-stats"/>
                        </HBox>

                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label fx:id="resultStatsLabel" text="" styleClass="result-stats"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="copyResultBtn" text="Copy" styleClass="btn-outline" onAction="#copyResult">
                                <graphic>
                                    <FontIcon iconLiteral="bi-clipboard" iconSize="14"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Copy Result (Ctrl+Shift+C)"/>
                                </tooltip>
                            </Button>
                            <Button fx:id="saveResultBtn" text="Save" styleClass="btn-outline" onAction="#saveResult">
                                <graphic>
                                    <FontIcon iconLiteral="bi-save" iconSize="14"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Save Result (Ctrl+Alt+S)"/>
                                </tooltip>
                            </Button>
                            <Button fx:id="saveAllResultsBtn" text="Save All" styleClass="btn-outline"
                                    onAction="#saveAllBatchResults" visible="false" managed="false">
                                <graphic>
                                    <FontIcon iconLiteral="bi-download" iconSize="14"/>
                                </graphic>
                                <tooltip>
                                    <Tooltip text="Save all batch results to files"/>
                                </tooltip>
                            </Button>
                        </HBox>

                        <TextArea fx:id="transformationResultArea" VBox.vgrow="ALWAYS" styleClass="code-preview"
                                  editable="false" wrapText="false"/>
                    </VBox>
                </Tab>

                <!-- Live Preview Tab -->
                <Tab text="Live Preview" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-eye" iconSize="16" iconColor="#007bff"/>
                    </graphic>
                    <VBox spacing="5">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Live HTML Preview" styleClass="section-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="refreshPreviewBtn" text="Refresh" styleClass="btn-outline"
                                    onAction="#refreshPreview">
                                <graphic>
                                    <FontIcon iconLiteral="bi-arrow-clockwise" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <WebView fx:id="previewWebView" VBox.vgrow="ALWAYS"/>
                    </VBox>
                </Tab>

                <!-- Performance Tab -->
                <Tab text="Performance" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-speedometer2" iconSize="16" iconColor="#ffc107"/>
                    </graphic>
                    <VBox spacing="10">
                        <HBox spacing="20">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Transformation Metrics" styleClass="subsection-header"/>
                                <GridPane hgap="10" vgap="5" styleClass="stats-grid">
                                    <Label text="Execution Time:" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="executionTimeLabel" text="0ms" GridPane.columnIndex="1"
                                           GridPane.rowIndex="0"/>
                                    <Label text="Compilation Time:" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="compilationTimeLabel" text="0ms" GridPane.columnIndex="1"
                                           GridPane.rowIndex="1"/>
                                    <Label text="Memory Usage:" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <Label fx:id="memoryUsageLabel" text="0MB" GridPane.columnIndex="1"
                                           GridPane.rowIndex="2"/>
                                    <Label text="Output Size:" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                    <Label fx:id="outputSizeLabel" text="0KB" GridPane.columnIndex="1"
                                           GridPane.rowIndex="3"/>
                                </GridPane>
                            </VBox>

                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="XSLT Features Used" styleClass="subsection-header"/>
                                <ListView fx:id="featuresListView" prefHeight="120"
                                         />
                            </VBox>
                        </HBox>

                        <!-- Performance Details -->
                        <VBox spacing="5" VBox.vgrow="ALWAYS">
                            <Label text="Detailed Performance Report" styleClass="subsection-header"/>
                            <TextArea fx:id="performanceReportArea" VBox.vgrow="ALWAYS" styleClass="code-preview"
                                      editable="false" wrapText="true"/>
                        </VBox>
                    </VBox>
                </Tab>

                <!-- Debug Tab -->
                <Tab text="Debug" closable="false">
                    <graphic>
                        <FontIcon iconLiteral="bi-bug" iconSize="16" iconColor="#dc3545"/>
                    </graphic>
                    <VBox spacing="10">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Debug Information" styleClass="section-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <CheckBox fx:id="enableDebugMode" text="Enable Debug Mode"/>
                            <Button fx:id="clearDebugBtn" text="Clear" styleClass="btn-outline" onAction="#clearDebug">
                                <graphic>
                                    <FontIcon iconLiteral="bi-trash" iconSize="14"/>
                                </graphic>
                            </Button>
                        </HBox>

                        <SplitPane dividerPositions="0.5" orientation="VERTICAL" VBox.vgrow="ALWAYS">
                            <VBox spacing="5">
                                <Label text="Messages &amp; Warnings" styleClass="subsection-header"/>
                                <ListView fx:id="messagesListView"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Template Execution Trace" styleClass="subsection-header"/>
                                <TextArea fx:id="traceArea" styleClass="code-preview" editable="false"/>
                            </VBox>
                        </SplitPane>
                    </VBox>
                </Tab>
            </TabPane>
            </VBox>

            <!-- Favorites Panel (unified component) -->
            <fx:include fx:id="favoritesPanel" source="controls/FavoritesPanel.fxml"/>
        </SplitPane>
    </SplitPane>
    </StackPane>
</VBox>